<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
    .hidden { display: none !important; }
    
    /* Login Styles */
    .login-split { display: flex; min-height: 100vh; }
    .login-left { background-color: #1e3a8a; color: white; width: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; }
    .login-right { background-color: white; width: 50%; display: flex; justify-content: center; align-items: center; padding: 40px; }
    @media (max-width: 768px) { .login-split { flex-direction: column; } .login-left, .login-right { width: 100%; min-height: 50vh; } }

    /* Form Styles */
    .paper { background: white; padding: 40px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; }
    .section-head { background: #e0f2fe; padding: 10px; border-left: 5px solid #0284c7; font-weight: bold; color: #075985; margin: 20px 0 10px 0; }
    
    .input-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
    .input-col { flex: 1; min-width: 200px; }
    label { display: block; font-weight: bold; font-size: 0.9rem; margin-bottom: 4px; color: #374151; }
    input[type="text"], input[type="number"], input[type="date"], select {
      width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-family: 'Sarabun';
    }
    input:focus, select:focus { border-color: #2563eb; outline: none; ring: 2px; }
    
    .check-list label { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; cursor: pointer; font-size: 0.95rem; }
    .check-list input { transform: scale(1.2); }
    
    /* Admin Tabs */
    .tab-btn { padding: 12px 20px; cursor: pointer; font-weight: bold; color: #64748b; border-bottom: 3px solid transparent; }
    .tab-btn.active { color: #1e3a8a; border-bottom-color: #1e3a8a; background: #eff6ff; }
  </style>
</head>
<body>

  <div id="loginSection" class="login-split">
    <div class="login-left">
      <h1 class="text-4xl font-bold mb-4 text-center">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
      <h2 class="text-2xl opacity-90 mb-8">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</h2>
      <p class="text-blue-200 text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>
      
      <button onclick="toggleLoginMode()" class="mt-10 text-xs text-blue-300 underline hover:text-white">
        ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà)
      </button>
    </div>

    <div class="login-right">
      <div class="w-full max-w-md">
        
        <div id="boxStudent">
           <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</h3>
           <form onsubmit="doLogin(event, 'student')" class="space-y-4">
             <div>
               <label>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (13 ‡∏´‡∏•‡∏±‡∏Å)</label>
               <input type="text" id="loginUser" maxlength="13" class="text-center text-xl tracking-widest bg-gray-50" placeholder="xxxxxxxxxxxxx" required>
             </div>
             <button type="submit" id="btnLoginStu" class="w-full bg-blue-900 text-white py-3 rounded-lg font-bold text-lg hover:bg-blue-800 shadow-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
           </form>
        </div>

        <div id="boxAdmin" class="hidden">
           <h3 class="text-2xl font-bold text-red-800 mb-6 text-center">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
           <form onsubmit="doLogin(event, 'admin')" class="space-y-4 border p-6 rounded-xl">
             <div><label>Username</label><input type="text" id="admUser" placeholder="admin"></div>
             <div><label>Password</label><input type="password" id="admPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
             <button type="submit" id="btnLoginAdm" class="w-full bg-red-800 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-red-700">Login</button>
           </form>
        </div>

      </div>
    </div>
  </div>

  <div id="adminSection" class="hidden max-w-7xl mx-auto p-6">
     <div class="bg-white rounded-xl shadow-lg overflow-hidden min-h-[80vh]">
        <div class="bg-gray-800 text-white p-5 flex justify-between items-center">
           <h2 class="text-xl font-bold">‚öôÔ∏è Admin Dashboard</h2>
           <button onclick="location.reload()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-sm font-bold">Log Out</button>
        </div>

        <div class="flex border-b bg-gray-50 px-4 gap-2 pt-2">
           <div onclick="switchTab('list')" id="tab-list" class="tab-btn active">üìÑ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
           <div onclick="switchTab('add')" id="tab-add" class="tab-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô)</div>
           <div onclick="switchTab('import')" id="tab-import" class="tab-btn">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel</div>
        </div>

        <div id="view-list" class="p-6">
           <div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead class="bg-gray-100 font-bold text-gray-700"><tr><th class="p-3">ID</th><th class="p-3">‡∏ä‡∏∑‡πà‡∏≠</th><th class="p-3">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th><th class="p-3">PDF</th><th class="p-3">Action</th></tr></thead><tbody id="tbodyList"></tbody></table></div>
        </div>

        <div id="view-add" class="p-8 hidden flex justify-center">
           <div class="bg-gray-50 p-8 rounded border max-w-md w-full">
              <h3 class="font-bold text-center mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</h3>
              <input id="addId" class="mb-3 w-full p-2 border rounded" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô" maxlength="13">
              <input id="addName" class="mb-3 w-full p-2 border rounded" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
              <button onclick="addSingle()" class="w-full bg-green-600 text-white p-2 rounded font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
           </div>
        </div>

        <div id="view-import" class="p-8 hidden text-center">
           <div class="border-2 border-dashed border-blue-300 p-10 rounded-xl cursor-pointer hover:bg-blue-50" onclick="document.getElementById('fileIn').click()">
              <input type="file" id="fileIn" class="hidden" onchange="readExcel(this)">
              <div class="text-4xl mb-2">üìä</div>
              <p class="font-bold text-gray-600">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏ß‡∏≤‡∏á</p>
              <p class="text-xs text-gray-400">Column A=ID, B=Name</p>
           </div>
           <div id="previewArea" class="hidden mt-4">
              <p class="font-bold text-green-600">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ <span id="countPreview">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
              <button onclick="runImport()" class="mt-2 bg-blue-900 text-white px-6 py-2 rounded shadow">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</button>
           </div>
        </div>
     </div>
  </div>

  <div id="formSection" class="hidden max-w-5xl mx-auto p-4 pb-20">
    
    <div id="adminBar" class="hidden sticky top-0 z-50 bg-yellow-100 border-l-4 border-yellow-500 p-4 mb-4 flex justify-between shadow-md">
       <span class="font-bold text-yellow-800">‚ö†Ô∏è ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
       <button onclick="exitAdminEdit()" class="bg-white px-3 py-1 rounded text-sm border hover:bg-gray-50">‡∏õ‡∏¥‡∏î</button>
    </div>

    <form id="appForm" onsubmit="saveForm(event)">
      
      <div class="paper">
         <div class="text-center border-b pb-4 mb-6">
            <h1 class="text-3xl font-bold text-blue-900">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p class="text-gray-500">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
         </div>

         <div class="bg-blue-50 p-4 rounded mb-6 border border-blue-200">
            <label class="text-lg text-blue-900 mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
            <select id="apply_level" name="apply_level" required class="font-bold text-lg">
               <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
               <option value="‡∏°.1">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1</option>
               <option value="‡∏°.4">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4</option>
            </select>
         </div>

         <div class="section-head">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
         <div class="input-row">
            <div class="input-col"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</label><select name="area_status"><option>‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</option><option>‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</option></select></div>
            <div class="input-col"><label>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏°</label><input type="text" name="old_school"></div>
         </div>
         <div class="input-row">
            <div class="input-col"><label>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><select name="program_select"><option>‡∏ß‡∏¥‡∏ó‡∏¢‡πå-‡∏Ñ‡∏ì‡∏¥‡∏ï</option><option>EIS</option><option>S&M</option><option>‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option></select></div>
         </div>

         <div class="section-head">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
         <div class="bg-gray-50 p-4 rounded border check-list">
            <label><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"> 1. ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
            <label><input type="checkbox" name="docs" value="‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"> 2. ‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</label>
            <label><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏¥‡∏î‡∏≤"> 3. ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏¥‡∏î‡∏≤</label>
            <label><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡∏£‡∏î‡∏≤"> 4. ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡∏£‡∏î‡∏≤</label>
            <label><input type="checkbox" name="docs" value="‡∏õ‡∏û.1"> 5. ‡∏õ‡∏û.1 / ‡∏õ‡∏û.7</label>
         </div>

         <div class="section-head">(1) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
         <div class="input-row">
            <div class="input-col"><label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label><select name="prefix"><option>‡∏î.‡∏ä.</option><option>‡∏î.‡∏ç.</option><option>‡∏ô‡∏≤‡∏¢</option><option>‡∏ô.‡∏™.</option></select></div>
            <div class="input-col"><label>‡∏ä‡∏∑‡πà‡∏≠(‡πÑ‡∏ó‡∏¢)</label><input type="text" name="name_th"></div>
            <div class="input-col"><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•(‡πÑ‡∏ó‡∏¢)</label><input type="text" name="surname_th"></div>
         </div>
         <div class="input-row">
            <div class="input-col"><label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label><input type="text" id="idCard" name="idCard" readonly class="bg-gray-100 cursor-not-allowed"></div>
            <div class="input-col"><label>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label><input type="date" name="dob"></div>
         </div>
         <div class="input-row">
            <div class="input-col"><label>‡∏´‡∏°‡∏π‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î</label><input type="text" name="blood"></div>
            <div class="input-col"><label>‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥</label><input type="text" name="nation"></div>
            <div class="input-col"><label>‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡∏ï‡∏¥</label><input type="text" name="race"></div>
            <div class="input-col"><label>‡∏®‡∏≤‡∏™‡∏ô‡∏≤</label><input type="text" name="religion"></div>
         </div>
      </div>

      <div class="paper">
         <div class="section-head">(2) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</div>
         <h4 class="font-bold border-b mb-3">üè† ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</h4>
         <div class="input-row">
            <div class="input-col"><label>‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label><input type="text" name="reg_no"></div>
            <div class="input-col"><label>‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà</label><input type="text" name="reg_moo"></div>
            <div class="input-col"><label>‡∏ï‡∏≥‡∏ö‡∏•</label><input type="text" name="reg_tum"></div>
            <div class="input-col"><label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label><input type="text" name="reg_amp"></div>
            <div class="input-col"><label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label><input type="text" name="reg_prov"></div>
         </div>
         
         <h4 class="font-bold border-b mb-3 mt-6">üìç ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô & ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h4>
         <div class="input-row">
            <div class="input-col"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><input type="text" name="phone_student" required></div>
         </div>

         <div class="section-head">(3) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
         <div class="input-row">
            <div class="input-col check-list">
               <label class="font-bold block mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≤‡∏î‡πÅ‡∏Ñ‡∏•‡∏ô</label>
               <label><input type="checkbox" name="lacking" value="‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"> ‡∏Ç‡∏≤‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
               <label><input type="checkbox" name="lacking" value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö"> ‡∏Ç‡∏≤‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö</label>
               <label><input type="checkbox" name="lacking" value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£"> ‡∏Ç‡∏≤‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô</label>
            </div>
            <div class="input-col">
               <label>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</label><input type="number" name="income_total">
               <label class="mt-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏Ñ‡∏ô)</label><input type="number" name="income_mem">
            </div>
         </div>
      </div>

      <div class="paper">
         <div class="section-head">(4) ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û & ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</div>
         <div class="input-row">
            <div class="input-col"><label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)</label><input type="number" name="weight"></div>
            <div class="input-col"><label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)</label><input type="number" name="height"></div>
         </div>
         
         <div class="input-row">
            <div class="input-col"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏î‡∏≤‡∏°‡∏≤‡∏£‡∏î‡∏≤</label><select name="parent_status"><option>‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô</option><option>‡∏´‡∏¢‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏á</option><option>‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà</option></select></div>
         </div>

         <div class="bg-gray-50 p-4 rounded mb-4">
            <h4 class="font-bold text-blue-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏¥‡∏î‡∏≤</h4>
            <div class="input-row">
               <div class="input-col"><input placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" name="dad_name"></div>
               <div class="input-col"><input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" name="dad_phone"></div>
            </div>
         </div>
         <div class="bg-gray-50 p-4 rounded">
            <h4 class="font-bold text-pink-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏£‡∏î‡∏≤</h4>
            <div class="input-row">
               <div class="input-col"><input placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" name="mom_name"></div>
               <div class="input-col"><input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" name="mom_phone"></div>
            </div>
         </div>
      </div>

      <div class="fixed bottom-0 left-0 w-full bg-white p-4 shadow-inner flex justify-center gap-4 z-50">
         <button type="submit" id="btnSave" class="bg-blue-900 text-white px-10 py-3 rounded-full font-bold shadow-lg hover:bg-blue-800 transform hover:scale-105 transition">
           üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
         </button>
         <a id="btnPDF" href="#" target="_blank" class="hidden bg-green-600 text-white px-10 py-3 rounded-full font-bold shadow-lg hover:bg-green-700 flex items-center gap-2">
           üìÑ ‡∏û‡∏¥‡∏°‡∏û‡πå PDF
         </a>
      </div>
      <div class="h-16"></div> </form>
  </div>

  <script>
    // ==========================================
    // üî¥üî¥ ‡πÉ‡∏™‡πà URL Deploy ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üî¥üî¥
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxtWZwXSFcbdrrPZSLrs4kmEDYB4fqx3MxUs0Wo40lgkAyIi_6C-j0AJ3YZgWOBJ16AHw/exec'; 
    // ==========================================

    let allData = [];
    let importData = [];

    function toggleLoginMode() {
       document.getElementById('boxStudent').classList.toggle('hidden');
       document.getElementById('boxAdmin').classList.toggle('hidden');
    }

    function switchTab(t) {
       ['list','add','import'].forEach(x => {
          document.getElementById('view-'+x).classList.add('hidden');
          document.getElementById('tab-'+x).classList.remove('active');
       });
       document.getElementById('view-'+t).classList.remove('hidden');
       document.getElementById('tab-'+t).classList.add('active');
    }

    // --- LOGIN ---
    function doLogin(e, role) {
       e.preventDefault();
       const u = role==='student' ? document.getElementById('loginUser').value : document.getElementById('admUser').value;
       const p = role==='student' ? '' : document.getElementById('admPass').value;
       const btn = role==='student' ? document.getElementById('btnLoginStu') : document.getElementById('btnLoginAdm');
       
       const oldTxt = btn.innerText;
       btn.innerText = 'Loading...'; btn.disabled = true;

       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'login', username:u, password:p})})
       .then(r=>r.json()).then(res => {
          if(!res.success && res.error) return alert(res.error);
          
          document.getElementById('loginSection').classList.add('hidden');
          
          if(res.role === 'admin') {
             document.getElementById('adminSection').classList.remove('hidden');
             allData = res.data;
             renderList();
          } else {
             document.getElementById('formSection').classList.remove('hidden');
             document.getElementById('idCard').value = u;
             if(res.found && res.data) {
                populateForm(res.data);
                if(res.data.pdf) showPDFBtn(res.data.pdf);
                alert('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß');
             }
          }
       })
       .catch(err => alert('Error: '+err))
       .finally(() => { btn.innerText = oldTxt; btn.disabled = false; });
    }

    // --- FORM SAVE ---
    function saveForm(e) {
       e.preventDefault();
       const btn = document.getElementById('btnSave');
       btn.innerText = '‚è≥ Saving...'; btn.disabled = true;

       const formData = {};
       const inputs = document.querySelectorAll('input, select');
       inputs.forEach(el => {
          if(el.type === 'checkbox') {
             if(!formData[el.name]) formData[el.name] = [];
             if(el.checked) formData[el.name].push(el.value);
          } else if(el.type === 'radio') {
             if(el.checked) formData[el.name] = el.value;
          } else {
             formData[el.id || el.name] = el.value;
          }
       });
       // Join arrays
       if(Array.isArray(formData.docs)) formData.docs = formData.docs.join(', ');
       if(Array.isArray(formData.lacking)) formData.lacking = formData.lacking.join(', ');

       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'save', data:formData})})
       .then(r=>r.json()).then(res => {
          if(res.success) {
             alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
             showPDFBtn(res.url);
          } else alert('Error: '+res.error);
       })
       .finally(() => { btn.innerText = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£'; btn.disabled = false; });
    }

    function showPDFBtn(url) {
       const btn = document.getElementById('btnPDF');
       btn.href = url;
       btn.classList.remove('hidden');
    }

    function populateForm(data) {
       const inputs = document.querySelectorAll('input, select');
       inputs.forEach(el => {
          const key = el.id || el.name;
          if(el.type==='checkbox') {
             if(data[el.name] && data[el.name].includes(el.value)) el.checked = true;
          } else {
             if(data[key]) el.value = data[key];
          }
       });
    }

    // --- ADMIN FUNCS ---
    function renderList() {
       const tb = document.getElementById('tbodyList'); tb.innerHTML='';
       allData.forEach((d, i) => {
          tb.innerHTML += `<tr class="border-b"><td class="p-3 text-xs">${new Date().toLocaleDateString()}</td><td class="p-3 font-mono font-bold text-blue-700">${d.id}</td><td class="p-3">${d.name}</td><td class="p-3">${d.level||'-'}</td><td class="p-3"><a href="${d.pdf}" target="_blank" class="text-blue-600 underline">PDF</a></td><td class="p-3"><button onclick="editUser(${i})" class="bg-yellow-100 text-yellow-700 px-2 rounded text-xs font-bold">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td></tr>`;
       });
    }
    
    function editUser(i) {
       const d = allData[i].full;
       document.getElementById('adminSection').classList.add('hidden');
       document.getElementById('formSection').classList.remove('hidden');
       document.getElementById('adminBar').classList.remove('hidden');
       populateForm(d);
       if(d.pdf) showPDFBtn(d.pdf);
    }
    function exitAdminEdit() {
       document.getElementById('appForm').reset();
       document.getElementById('formSection').classList.add('hidden');
       document.getElementById('adminSection').classList.remove('hidden');
       document.getElementById('adminBar').classList.add('hidden');
       document.getElementById('btnPDF').classList.add('hidden');
    }

    function addSingle() {
       const id = document.getElementById('addId').value;
       const name = document.getElementById('addName').value;
       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'appendWhitelist', data:{id,name}})})
       .then(r=>r.json()).then(res => alert(res.success?'OK':'Error'));
    }

    function readExcel(inp) {
       const f = inp.files[0];
       const r = new FileReader();
       r.onload = e => {
          const wb = XLSX.read(e.target.result, {type:'array'});
          const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header:1});
          importData = rows.map(r=>({id:r[0], name:r[1]})).filter(x=>x.id);
          document.getElementById('previewBox').classList.remove('hidden');
          document.getElementById('countRow').innerText = importData.length;
       };
       r.readAsArrayBuffer(f);
    }
    function uploadExcel() {
       if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?')) return;
       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'updateWhitelist', listData:importData})})
       .then(r=>r.json()).then(res=>{ alert('Success'); location.reload(); });
    }
  </script>
</body>
</html>
