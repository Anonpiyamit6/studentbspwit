<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
    .hidden { display: none !important; }

    /* Paper UI Styles */
    .a4-paper {
      background: white; width: 210mm; min-height: 297mm; margin: 20px auto;
      padding: 15mm 20mm; position: relative; 
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    @media (max-width: 768px) { .a4-paper { width: 100%; padding: 10px; margin: 0; } }

    /* Inputs mimicking paper lines */
    .dot-input {
      border: none; border-bottom: 1px dotted #000; width: 100%;
      outline: none; color: #00008b; font-weight: bold; background: transparent;
      padding: 0 4px; border-radius: 0;
    }
    .chk-box {
      width: 16px; height: 16px; border: 1px solid #000; 
      display: inline-flex; align-items: center; justify-content: center;
      margin-right: 5px; cursor: pointer; vertical-align: middle;
    }
    .chk-box:checked { background: #000; }
    .chk-box:checked::after { content: '‚úì'; color: white; font-size: 12px; }
    
    /* ID Card Boxes */
    .id-segment { display: flex; gap: 2px; }
    .id-box {
      width: 20px; height: 26px; border: 1px solid #000; text-align: center;
      font-weight: bold; border-radius: 2px; font-size: 14px;
    }

    /* Photo Upload */
    .photo-area {
      width: 35mm; height: 45mm; border: 1px solid #000; background: #f9fafb;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      cursor: pointer; overflow: hidden; position: relative;
    }
    .photo-preview { width: 100%; height: 100%; object-fit: cover; position: absolute; }

    /* Animation */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
  </style>
</head>
<body>

  <!-- üü¢ SECTION 1: MODERN LOGIN (Split-Screen) -->
  <div id="loginSection" class="min-h-screen flex w-full bg-white font-sarabun">
    
    <!-- Left Side: Hero Image (Hidden on small screens) -->
    <div class="hidden lg:flex lg:w-1/2 bg-blue-900 relative overflow-hidden items-center justify-center">
      <div class="absolute inset-0 z-0">
        <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        <img src="https://images.unsplash.com/photo-1523050854058-8df90110c9f1?q=80&w=2070&auto=format&fit=crop" 
             class="w-full h-full object-cover opacity-40 mix-blend-overlay">
      </div>
      <div class="absolute inset-0 bg-gradient-to-br from-blue-900/90 to-black/50 z-10"></div>
      
      <div class="relative z-20 text-white p-12 max-w-xl">
        <div class="flex items-center gap-4 mb-6">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Emblem_of_the_Ministry_of_Education_of_Thailand.svg/1200px-Emblem_of_the_Ministry_of_Education_of_Thailand.svg.png" 
                 class="h-20 drop-shadow-lg bg-white/10 rounded-full p-2 backdrop-blur-sm">
            <div>
                <h2 class="text-3xl font-bold tracking-wide">Bangsaphanwittaya</h2>
                <p class="text-blue-200 tracking-widest text-sm uppercase">Admission System</p>
            </div>
        </div>
        <h1 class="text-5xl font-bold mb-6 leading-tight">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br>‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
        <p class="text-lg text-blue-100 font-light leading-relaxed">
          ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ 
          ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
        </p>
      </div>
    </div>

    <!-- Right Side: Login Form -->
    <div class="w-full lg:w-1/2 flex items-center justify-center p-8 lg:p-16 bg-white relative">
      <div class="w-full max-w-md space-y-8">
        
        <div class="text-center lg:text-left">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Emblem_of_the_Ministry_of_Education_of_Thailand.svg/1200px-Emblem_of_the_Ministry_of_Education_of_Thailand.svg.png" 
                 class="h-16 mx-auto lg:hidden mb-4">
            <h2 class="text-3xl font-bold text-slate-900">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
            <p class="mt-2 text-slate-500 text-lg">Identity Verification</p>
        </div>

        <form class="mt-8 space-y-6" onsubmit="handleLogin(event)">
          <div class="space-y-4">
            <div>
              <label for="loginUser" class="block text-sm font-medium text-slate-700 mb-1">
                ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (13 ‡∏´‡∏•‡∏±‡∏Å)
              </label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                  </svg>
                </div>
                <input id="loginUser" name="loginUser" type="text" required maxlength="13"
                       class="block w-full pl-10 pr-3 py-4 border border-slate-300 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent transition duration-200 text-xl tracking-[0.2em] font-mono" 
                       placeholder="XXXXXXXXXXXXX">
              </div>
            </div>
          </div>

          <div class="pt-2">
            <button type="submit" id="btnLogin"
                    class="group relative w-full flex justify-center items-center py-4 px-4 border border-transparent text-lg font-semibold rounded-xl text-white bg-blue-900 hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-900 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
              <span id="btnLoginText">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
              
              <!-- Loading Spinner -->
              <svg id="btnSpinner" class="hidden animate-spin ml-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </button>
          </div>
        </form>
        
        <div class="mt-6 flex flex-col items-center justify-center space-y-4">
             <div class="text-xs text-slate-400">¬© 2025 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤. All rights reserved.</div>
             <button onclick="toggleAdmin()" class="text-slate-300 hover:text-blue-600 text-xs transition underline decoration-dotted">Staff Access</button>
        </div>

        <!-- Admin Box (Overlay) -->
        <div id="adminLoginArea" class="hidden absolute inset-0 w-full h-full bg-white/95 backdrop-blur-md z-50 flex items-center justify-center p-8 animate-fade-in">
           <div class="w-full max-w-xs relative text-center">
               <button onclick="toggleAdmin()" class="absolute -top-10 right-0 text-slate-400 hover:text-slate-600 text-xl font-bold">‚úï ‡∏õ‡∏¥‡∏î</button>
               <h3 class="text-xl font-bold text-slate-800 mb-4">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h3>
               <input type="password" id="adminPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin" 
                      class="w-full border border-slate-300 rounded-lg px-4 py-3 mb-4 focus:ring-2 focus:ring-blue-600 focus:outline-none text-center">
               <button onclick="handleLoginAdmin()" class="w-full bg-slate-800 text-white rounded-lg py-3 hover:bg-slate-700 transition font-bold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
           </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üîµ SECTION 2: APPLICATION FORM (Paper Style) -->
  <div id="formSection" class="hidden pb-20 animate-fade-in">
    <form id="appForm" onsubmit="submitForm(event)">

      <!-- Page 1 -->
      <div class="a4-paper">
         <div class="absolute top-5 right-5 text-xs text-gray-400">‡∏´‡∏ô‡πâ‡∏≤ 1</div>
         
         <div class="flex justify-between items-start mb-6">
            <div class="flex-1 text-center pt-2 pl-[35mm]"> 
               <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Emblem_of_the_Ministry_of_Education_of_Thailand.svg/1200px-Emblem_of_the_Ministry_of_Education_of_Thailand.svg.png" class="h-16 mx-auto mb-1">
               <div class="font-bold text-lg">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1</div>
               <div class="font-bold text-base">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</div>
            </div>
            <div class="flex flex-col items-end">
               <div class="flex items-center text-xs mb-1">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ <div class="border border-black w-20 h-5 ml-1"></div></div>
               <div class="photo-area" onclick="document.getElementById('fileIn').click()">
                  <span class="text-xs text-center p-2 text-gray-400">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢ 1.5 ‡∏ô‡∏¥‡πâ‡∏ß<br>(‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)</span>
                  <img id="preview" class="photo-preview hidden">
               </div>
               <input type="file" id="fileIn" class="hidden" accept="image/*" onchange="loadPhoto(this)">
            </div>
         </div>

         <!-- Fields Section -->
         <div class="space-y-4 text-sm font-sarabun">
            <div>
               <div class="font-bold border-b border-black inline-block mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏Ç‡πâ‡∏≠)</div>
               <div class="ml-4">
                  <label class="block cursor-pointer"><input type="radio" name="area_status" value="‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï" class="chk-box"> ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ï.‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î‡∏ô‡∏û‡∏Ñ‡∏∏‡∏ì, ‡∏ï.‡∏û‡∏á‡∏®‡πå‡∏õ‡∏£‡∏∞‡∏®‡∏≤‡∏™‡∏ô‡πå, ‡∏ï.‡πÅ‡∏°‡πà‡∏£‡∏≥‡∏û‡∏∂‡∏á, ‡∏ï.‡∏ó‡∏≠‡∏á‡∏°‡∏á‡∏Ñ‡∏•, ‡∏ï.‡∏£‡πà‡∏≠‡∏ô‡∏ó‡∏≠‡∏á)</label>
                  <label class="block cursor-pointer"><input type="radio" name="area_status" value="‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï" class="chk-box"> ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
               </div>
            </div>

            <div class="flex items-baseline">
               <span class="font-bold mr-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span>
               <input name="old_school" class="dot-input">
            </div>

            <div>
               <div class="font-bold border-b border-black inline-block mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</div>
               <div class="grid grid-cols-2 ml-4 gap-2">
                  <label class="cursor-pointer"><input type="radio" name="program_select" value="‡∏ß‡∏¥‡∏ó‡∏¢‡πå-‡∏Ñ‡∏ì‡∏¥‡∏ï" class="chk-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡πå - ‡∏Ñ‡∏ì‡∏¥‡∏ï</label>
                  <label class="cursor-pointer"><input type="radio" name="program_select" value="EIS" class="chk-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô EIS</label>
                  <label class="cursor-pointer"><input type="radio" name="program_select" value="S&M" class="chk-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô S&M</label>
                  <label class="cursor-pointer"><input type="radio" name="program_select" value="GATE" class="chk-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô GATE</label>
               </div>
            </div>

            <div>
               <div class="font-bold border-b border-black inline-block mb-1">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
               <div class="ml-4 space-y-1">
                  <div class="flex justify-between"><label class="cursor-pointer"><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="chk-box"> 1. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <span>1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
                  <div class="flex justify-between"><label class="cursor-pointer"><input type="checkbox" name="docs" value="‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£" class="chk-box"> 2. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <span>1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
                  <div class="flex justify-between"><label class="cursor-pointer"><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏¥‡∏î‡∏≤" class="chk-box"> 3. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏¥‡∏î‡∏≤</label> <span>1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
                  <div class="flex justify-between"><label class="cursor-pointer"><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡∏£‡∏î‡∏≤" class="chk-box"> 4. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡∏£‡∏î‡∏≤</label> <span>1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
                  <div class="flex justify-between"><label class="cursor-pointer"><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á" class="chk-box"> 5. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label> <span>1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
                  <div class="flex justify-between"><label class="cursor-pointer"><input type="checkbox" name="docs" value="‡∏õ‡∏û.1" class="chk-box"> 6. ‡∏õ‡∏û.1 ‡∏´‡∏£‡∏∑‡∏≠ ‡∏õ‡∏û.7</label> <span>1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
                  <div class="flex items-baseline"><label class="cursor-pointer"><input type="checkbox" name="docs" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="chk-box"> 7. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)</label> <input name="doc_other" class="dot-input w-32 mx-2"> <span>1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
               </div>
            </div>

            <div>
               <div class="font-bold border-b border-black inline-block mb-1">(1) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
               <div class="flex items-baseline gap-2 mb-2">
                  <span>‡∏ä‡∏∑‡πà‡∏≠</span>
                  <select name="prefix" class="bg-transparent border-b border-dotted border-black outline-none"><option>‡∏î.‡∏ä.</option><option>‡∏î.‡∏ç.</option><option>‡∏ô‡∏≤‡∏¢</option><option>‡∏ô.‡∏™.</option></select>
                  <input name="name_th" class="dot-input w-1/3">
                  <span>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
                  <input name="surname_th" class="dot-input w-1/3">
               </div>
               <div class="flex items-baseline gap-2 mb-2">
                  <span>Name (Eng)</span> <input name="name_en" class="dot-input w-1/3">
                  <span>Surname</span> <input name="surname_en" class="dot-input w-1/3">
               </div>
               
               <div class="flex items-center gap-2 mb-2">
                  <span class="font-bold">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</span>
                  <div class="flex gap-3" id="idCardContainer"></div> <input type="hidden" name="idCard" id="realIdCard">
               </div>

               <div class="flex items-baseline gap-2 mb-2">
                  <span>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</span> <input type="date" name="dob" class="dot-input w-40">
                  <span>‡∏£‡∏û.</span> <input name="birth_hosp" class="dot-input w-32">
               </div>
               <div class="flex items-baseline gap-2">
                   <span>‡∏ï.</span> <input name="birth_tum" class="dot-input">
                   <span>‡∏≠.</span> <input name="birth_amp" class="dot-input">
                   <span>‡∏à.</span> <input name="birth_prov" class="dot-input">
               </div>
               <div class="flex items-baseline gap-2 mt-2">
                   <span>‡∏´‡∏°‡∏π‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î</span> <input name="blood" class="dot-input w-12">
                   <span>‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥</span> <input name="nation" class="dot-input w-16">
                   <span>‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡∏ï‡∏¥</span> <input name="race" class="dot-input w-16">
                   <span>‡∏®‡∏≤‡∏™‡∏ô‡∏≤</span> <input name="religion" class="dot-input w-16">
               </div>
            </div>
         </div>
      </div>

      <!-- Page 2 -->
      <div class="a4-paper">
         <div class="absolute top-5 right-5 text-xs text-gray-400">‡∏´‡∏ô‡πâ‡∏≤ 2</div>
         <div class="font-bold text-lg mb-2">(2) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</div>
         <div class="text-sm space-y-4">
            <div>
               <div class="font-bold underline">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≤‡∏°‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</div>
               <div class="flex items-baseline mb-1">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô <input name="reg_code" class="dot-input w-1/2"></div>
               <div class="flex items-baseline gap-2 mb-1">
                  ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <input name="reg_no" class="dot-input w-16">
                  ‡∏´‡∏°‡∏π‡πà <input name="reg_moo" class="dot-input w-12">
                  ‡∏ñ‡∏ô‡∏ô <input name="reg_road" class="dot-input flex-1">
               </div>
               <div class="flex items-baseline gap-2 mb-1">
                  ‡∏ï‡∏≥‡∏ö‡∏• <input name="reg_tum" class="dot-input flex-1">
                  ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <input name="reg_amp" class="dot-input flex-1">
               </div>
               <div class="flex items-baseline gap-2">
                  ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <input name="reg_prov" class="dot-input flex-1">
                  ‡∏£‡∏´‡∏±‡∏™ ‡∏õ‡∏ì. <input name="reg_zip" class="dot-input w-20">
                  ‡πÇ‡∏ó‡∏£ <input name="reg_tel" class="dot-input w-32">
               </div>
            </div>
            
            <div>
               <div class="font-bold underline">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
               <div class="flex items-baseline mb-1">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô <input name="cur_code" class="dot-input w-1/2"></div>
               <div class="flex items-baseline gap-2 mb-1">
                  ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <input name="cur_no" class="dot-input w-16">
                  ‡∏´‡∏°‡∏π‡πà <input name="cur_moo" class="dot-input w-12">
                  ‡∏ñ‡∏ô‡∏ô <input name="cur_road" class="dot-input flex-1">
               </div>
               <div class="flex items-baseline gap-2 mb-1">
                  ‡∏ï‡∏≥‡∏ö‡∏• <input name="cur_tum" class="dot-input flex-1">
                  ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <input name="cur_amp" class="dot-input flex-1">
               </div>
               <div class="flex items-baseline gap-2">
                  ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <input name="cur_prov" class="dot-input flex-1">
                  ‡∏£‡∏´‡∏±‡∏™ ‡∏õ‡∏ì. <input name="cur_zip" class="dot-input w-20">
                  ‡πÇ‡∏ó‡∏£ <input name="cur_tel" class="dot-input w-32 bg-yellow-50">
               </div>
            </div>
         </div>

         <div class="font-bold text-lg mt-4 mb-2">(3) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
         <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
               <div class="font-bold">‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡∏ô‡∏≠‡∏ô</div>
               <label class="block cursor-pointer"><input type="radio" name="living" value="‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà" class="chk-box"> ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà</label>
               <label class="block cursor-pointer"><input type="radio" name="living" value="‡∏ç‡∏≤‡∏ï‡∏¥" class="chk-box"> ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ç‡∏≤‡∏ï‡∏¥</label>
               <label class="block cursor-pointer"><input type="radio" name="living" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="chk-box"> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
            </div>
            <div>
               <div class="font-bold">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏≠‡∏¢‡πÇ‡∏≠‡∏Å‡∏≤‡∏™</div>
               <div class="flex items-baseline">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° <input name="inc_total" class="dot-input w-20"> ‡∏ö./‡∏î.</div>
               <div class="flex items-baseline">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <input name="mem_count" class="dot-input w-10"> ‡∏Ñ‡∏ô</div>
               <label class="block mt-1 cursor-pointer"><input type="radio" name="poor" value="‡∏¢‡∏≤‡∏Å‡∏à‡∏ô" class="chk-box"> ‡∏¢‡∏≤‡∏Å‡∏à‡∏ô (<= 3,000)</label>
               <label class="block cursor-pointer"><input type="radio" name="poor" value="‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏Å‡∏à‡∏ô" class="chk-box"> ‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏Å‡∏à‡∏ô (> 3,000)</label>
            </div>
         </div>
         
         <div class="text-sm mt-4">
             <div class="font-bold">‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</div>
             <div class="flex gap-3">
                 <label class="cursor-pointer"><input type="radio" name="travel" value="‡πÄ‡∏î‡∏¥‡∏ô" class="chk-box"> ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ó‡πâ‡∏≤</label>
                 <label class="cursor-pointer"><input type="radio" name="travel" value="‡∏£‡∏ñ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß" class="chk-box"> ‡∏£‡∏ñ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</label>
                 <label class="cursor-pointer"><input type="radio" name="travel" value="‡∏£‡∏ñ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£" class="chk-box"> ‡∏£‡∏ñ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£</label>
             </div>
             <div class="flex items-baseline gap-2 mt-1">
                 ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á <input name="distance" class="dot-input w-16"> ‡∏Å‡∏°. ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ <input name="time_use" class="dot-input w-16"> ‡∏ô‡∏≤‡∏ó‡∏µ
             </div>
         </div>
      </div>

      <!-- Page 3 -->
      <div class="a4-paper">
         <div class="absolute top-5 right-5 text-xs text-gray-400">‡∏´‡∏ô‡πâ‡∏≤ 3</div>
         <div class="font-bold text-lg mb-2">(5) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</div>
         <div class="text-sm space-y-4">
            <div class="flex items-baseline">
               <span class="font-bold mr-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏î‡∏≤‡∏°‡∏≤‡∏£‡∏î‡∏≤:</span>
               <select name="marry_status" class="border border-black"><option>‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</option><option>‡πÑ‡∏°‡πà‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</option><option>‡∏´‡∏¢‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏á</option><option>‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà</option><option>‡∏ñ‡∏∂‡∏á‡πÅ‡∏Å‡πà‡∏Å‡∏£‡∏£‡∏°</option></select>
            </div>
            
            <div class="p-2 border border-black rounded bg-gray-50">
               <div class="font-bold">‡∏ö‡∏¥‡∏î‡∏≤ (‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£)</div>
               <div class="flex items-baseline">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏Ø <input name="f_id" class="dot-input w-40"></div>
               <div class="flex items-baseline">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• <input name="f_name" class="dot-input flex-1"></div>
               <div class="flex items-baseline gap-2">
                  ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û <input name="f_job" class="dot-input flex-1"> ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ <input name="f_inc" class="dot-input w-24">
                  ‡πÇ‡∏ó‡∏£ <input name="f_tel" class="dot-input w-32">
               </div>
            </div>

            <div class="p-2 border border-black rounded bg-gray-50">
               <div class="font-bold">‡∏°‡∏≤‡∏£‡∏î‡∏≤ (‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£)</div>
               <div class="flex items-baseline">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏Ø <input name="m_id" class="dot-input w-40"></div>
               <div class="flex items-baseline">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• <input name="m_name" class="dot-input flex-1"></div>
               <div class="flex items-baseline gap-2">
                  ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û <input name="m_job" class="dot-input flex-1"> ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ <input name="m_inc" class="dot-input w-24">
                  ‡πÇ‡∏ó‡∏£ <input name="m_tel" class="dot-input w-32">
               </div>
            </div>

            <div class="p-2 border border-black rounded bg-gray-50">
               <div class="font-bold">‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà)</div>
               <div class="flex items-baseline">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô <input name="g_rel" class="dot-input w-32"></div>
               <div class="flex items-baseline">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• <input name="g_name" class="dot-input flex-1"></div>
               <div class="flex items-baseline gap-2">
                  ‡πÇ‡∏ó‡∏£ <input name="g_tel" class="dot-input w-32">
               </div>
            </div>

            <div class="text-center mt-8">
               ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ................................................................<br>
               ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ <input type="date" name="sign_date" class="border p-1">
            </div>
         </div>
      </div>

      <!-- Page 4 -->
      <div class="a4-paper">
         <div class="absolute top-5 right-5 text-xs text-gray-400">‡∏´‡∏ô‡πâ‡∏≤ 4</div>
         <div class="font-bold text-lg border-b border-black inline-block mb-4">(‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà)</div>
         
         <div class="space-y-4">
             <label class="block p-2 hover:bg-green-50 rounded cursor-pointer">
                 <input type="radio" name="admin_check_result" value="‡∏ú‡πà‡∏≤‡∏ô" class="chk-box"> 
                 <b>‡∏ú‡πà‡∏≤‡∏ô:</b> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö
             </label>
             <label class="block p-2 hover:bg-red-50 rounded cursor-pointer">
                 <input type="radio" name="admin_check_result" value="‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô" class="chk-box"> 
                 <b>‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô:</b> ‡∏Ç‡∏≤‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
                 <textarea name="missing_note" class="w-full border p-2 mt-1 h-20 bg-white" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç..."></textarea>
             </label>
         </div>
      </div>

      <!-- Submit Floating Button -->
      <div class="fixed bottom-0 left-0 w-full bg-white/80 backdrop-blur-md border-t p-4 flex justify-center z-50 shadow-lg">
         <button type="submit" id="btnSave" class="bg-blue-900 text-white text-lg font-bold py-3 px-16 rounded-full hover:bg-blue-800 shadow-xl transition transform hover:scale-105">
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
         </button>
      </div>

    </form>
  </div>

  <script>
    // üî¥üî¥üî¥ ‡πÉ‡∏™‡πà URL ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (URL ‡∏à‡∏≤‡∏Å Google Apps Script) üî¥üî¥üî¥
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxtWZwXSFcbdrrPZSLrs4kmEDYB4fqx3MxUs0Wo40lgkAyIi_6C-j0AJ3YZgWOBJ16AHw/exec'; 

    let photoBase64 = null;
    let existingPhoto = null;

    // --- Init ID Card Grid ---
    function init() {
       const c = document.getElementById('idCardContainer');
       [1, 4, 5, 2, 1].forEach((count, idxGroup) => {
          const div = document.createElement('div'); div.className = 'id-segment';
          for(let i=0; i<count; i++) {
             const inp = document.createElement('input');
             inp.className = 'id-box'; inp.maxLength = 1;
             inp.onkeyup = (e) => {
                inp.value = inp.value.replace(/[^0-9]/g,'');
                if(inp.value && inp.nextElementSibling) inp.nextElementSibling.focus();
                else if(inp.value && !inp.nextElementSibling && div.nextElementSibling) div.nextElementSibling.firstChild.focus();
                
                let val = '';
                document.querySelectorAll('.id-box').forEach(b => val += b.value);
                document.getElementById('realIdCard').value = val;
             };
             div.appendChild(inp);
          }
          c.appendChild(div);
       });
    }
    init();

    // --- Login Functions ---
    function toggleAdmin(){
       document.getElementById('adminLoginArea').classList.toggle('hidden');
    }

    function handleLoginAdmin() {
       const p = document.getElementById('adminPass').value;
       const btn = event.target; 
       const originalText = btn.innerText;
       btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
       
       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'login', username:'admin', password:p})})
       .then(r=>r.json()).then(res => {
          if(res.role === 'admin') {
             alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°)');
             document.getElementById('loginSection').classList.add('hidden');
             document.getElementById('formSection').classList.remove('hidden');
          } else {
             alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
          }
       }).finally(()=>btn.innerText = originalText);
    }

    function handleLogin(e) {
       e.preventDefault();
       const u = document.getElementById('loginUser').value.trim();
       if(!u || u.length !== 13) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 13 ‡∏´‡∏•‡∏±‡∏Å');

       // UI Loading State
       const btn = document.getElementById('btnLogin');
       const btnText = document.getElementById('btnLoginText');
       const btnSpinner = document.getElementById('btnSpinner');
       
       btn.disabled = true;
       btnText.classList.add('hidden');
       btnSpinner.classList.remove('hidden');

       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'login', username:u, password:''})})
       .then(r => r.json())
       .then(res => {
          if(!res.success) {
             alert('‚ùå ' + res.error);
             btn.disabled = false;
             btnText.classList.remove('hidden');
             btnSpinner.classList.add('hidden');
          } else {
             // Success
             document.getElementById('loginSection').classList.add('hidden');
             document.getElementById('formSection').classList.remove('hidden');
             window.scrollTo(0,0);
             
             // ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
             const chars = u.split('');
             document.querySelectorAll('.id-box').forEach((b,i) => { if(chars[i]) b.value = chars[i]; });
             document.getElementById('realIdCard').value = u;

             if(res.found && res.data) {
                populate(res.data);
                if(res.data.photoUrl) {
                   document.getElementById('preview').src = res.data.photoUrl;
                   document.getElementById('preview').classList.remove('hidden');
                   existingPhoto = res.data.photoUrl;
                }
                alert('‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö');
             } else {
                alert('üëã ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ' + (res.nameFromList || '') + ' ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£');
             }
          }
       })
       .catch(err => {
           alert('Error: ' + err);
           btn.disabled = false;
           btnText.classList.remove('hidden');
           btnSpinner.classList.add('hidden');
       });
    }

    // --- Form Management ---
    function loadPhoto(input) {
       if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = (e) => {
             document.getElementById('preview').src = e.target.result;
             document.getElementById('preview').classList.remove('hidden');
             photoBase64 = e.target.result;
          };
          reader.readAsDataURL(input.files[0]);
       }
    }

    function submitForm(e) {
       e.preventDefault();
       if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?')) return;
       
       const btn = document.getElementById('btnSave');
       btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...'; btn.disabled = true;
       
       const fd = {};
       document.querySelectorAll('input, select, textarea').forEach(el => {
          if(el.type === 'radio') { if(el.checked) fd[el.name] = el.value; }
          else if(el.type === 'checkbox') { if(el.checked) { if(!fd[el.name]) fd[el.name]=[]; fd[el.name].push(el.value); } }
          else if(el.type !== 'file') fd[el.name] = el.value;
       });
       if(fd.docs && Array.isArray(fd.docs)) fd.docs = fd.docs.join(', ');

       if(photoBase64) fd.photoBase64 = photoBase64;
       if(existingPhoto) fd.existingPhoto = existingPhoto;

       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'save', data:fd})})
       .then(r=>r.json()).then(res => {
          if(res.success) {
              alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!');
              location.reload(); // ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
          } else {
              alert('Error: ' + res.error);
          }
       })
       .catch(e => alert('Error: ' + e))
       .finally(()=> { btn.innerText = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£'; btn.disabled = false; });
    }
    
    function populate(d) {
       Object.keys(d).forEach(k => {
          const els = document.getElementsByName(k);
          if(!els.length) return;
          if(els[0].type === 'radio') {
             els.forEach(r => { if(r.value == d[k]) r.checked = true; });
          } else if(els[0].type === 'checkbox' && d[k]) {
             const vals = d[k].split(', ');
             els.forEach(c => { if(vals.includes(c.value)) c.checked = true; });
          } else if(els[0].type !== 'file') {
             els[0].value = d[k];
          }
       });
    }
  </script>
</body>
</html>
