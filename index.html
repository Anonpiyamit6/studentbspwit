<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Admin Edit)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; }
    .hidden { display: none !important; }
    .input-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #1e3a8a; }
    .input-group input, .input-group select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; }
    .section-head { background: #e0f2fe; padding: 10px; font-weight: bold; color: #0c4a6e; border-left: 4px solid #0284c7; margin-top: 20px; margin-bottom: 10px; }
    .tab-btn { padding: 12px 24px; cursor: pointer; border-bottom: 3px solid transparent; font-weight: bold; color: #64748b; }
    .tab-btn.active { border-bottom-color: #1e3a8a; color: #1e3a8a; background: #f1f5f9; }
    .filter-btn { padding: 6px 12px; border-radius: 20px; border: 1px solid #ccc; cursor: pointer; font-size: 0.9rem; }
    .filter-btn.active { background-color: #1e3a8a; color: white; border-color: #1e3a8a; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <div id="loginSection" class="min-h-screen flex flex-col md:flex-row">
    <div class="md:w-1/2 bg-blue-900 flex flex-col justify-center items-center text-white p-10 relative">
      <h1 class="text-4xl font-bold mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
      <h2 class="text-2xl opacity-90">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</h2>
      <button onclick="toggleAdminLogin()" class="absolute bottom-4 left-4 text-blue-400 text-xs">Admin Login</button>
    </div>
    <div class="md:w-1/2 bg-white flex flex-col justify-center items-center p-8">
      <div class="w-full max-w-md">
        <div id="studentLoginBox">
          <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</h3>
          <form onsubmit="handleLogin(event, 'student')" class="space-y-4">
            <input type="text" id="loginIdCard" maxlength="13" required class="w-full p-4 border rounded-lg text-xl text-center bg-gray-50" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å">
            <button type="submit" id="btnLoginStudent" class="w-full bg-blue-900 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          </form>
        </div>
        <div id="adminLoginBox" class="hidden">
          <h3 class="text-2xl font-bold text-red-800 mb-6 text-center">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
          <form onsubmit="handleLogin(event, 'admin')" class="space-y-4">
            <input type="password" id="adminPass" required class="w-full p-3 border rounded" placeholder="Password">
            <button type="submit" id="btnLoginAdmin" class="w-full bg-red-800 text-white py-3 rounded-lg font-bold hover:bg-red-700">Login</button>
            <button type="button" onclick="toggleAdminLogin()" class="w-full text-gray-500 mt-2 text-sm text-center">‡∏Å‡∏•‡∏±‡∏ö</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="adminSection" class="hidden min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden min-h-[85vh]">
      <div class="bg-gray-800 text-white p-5 flex justify-between items-center">
        <h2 class="text-2xl font-bold">‚öôÔ∏è Admin Dashboard</h2>
        <button onclick="location.reload()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-sm">Logout</button>
      </div>

      <div class="flex border-b bg-gray-50">
        <div onclick="switchTab('applicants')" id="tab-applicants" class="tab-btn active">üìÑ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
        <div onclick="switchTab('import')" id="tab-import" class="tab-btn">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Excel)</div>
      </div>

      <div id="view-applicants" class="p-6">
        <div class="flex flex-wrap gap-2 mb-4 items-center">
          <span class="font-bold mr-2">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á:</span>
          <button onclick="applyFilter('all')" class="filter-btn active" id="filter-all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button onclick="applyFilter('M1')" class="filter-btn" id="filter-M1">‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏°.1</button>
          <button onclick="applyFilter('M4')" class="filter-btn" id="filter-M4">‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏°.4</button>
        </div>

        <div class="overflow-x-auto border rounded-lg">
          <table class="w-full text-left border-collapse">
            <thead class="bg-blue-50 text-blue-900 uppercase text-sm">
              <tr>
                <th class="p-3 border-b">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                <th class="p-3 border-b">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£</th>
                <th class="p-3 border-b">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                <th class="p-3 border-b text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="adminTableBody" class="bg-white text-sm"></tbody>
          </table>
        </div>
      </div>

      <div id="view-import" class="p-6 hidden">
         <div class="text-center p-10 border-2 border-dashed rounded bg-gray-50">
           <p class="mb-4">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel (.xlsx) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Whitelist</p>
           <input type="file" id="excelFile" accept=".xlsx, .xls" onchange="handleFileUpload(event)">
           <div class="mt-4" id="previewArea"></div>
           <button id="btnConfirmImport" onclick="confirmImport()" class="hidden bg-green-600 text-white px-6 py-2 rounded mt-4">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</button>
         </div>
      </div>
    </div>
  </div>

  <div id="formSection" class="hidden p-4 md:p-8 max-w-5xl mx-auto">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-xl relative">
      
      <div id="adminEditHeader" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 flex justify-between items-center">
        <div>
           <p class="font-bold">‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Admin)</p>
           <p class="text-sm">‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á: <span id="editingName" class="font-bold">-</span></p>
        </div>
        <button onclick="closeAdminEdit()" class="bg-gray-500 text-white px-4 py-2 rounded text-sm hover:bg-gray-600">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Dashboard</button>
      </div>

      <div class="flex justify-between items-center mb-6 border-b pb-4">
        <div>
           <h2 class="text-2xl font-bold text-blue-900">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h2>
           <p class="text-gray-500">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
        </div>
        <button id="btnStudentLogout" onclick="location.reload()" class="text-red-600 underline">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>

      <form id="appForm" onsubmit="submitForm(event)">
        <div class="bg-blue-50 p-4 rounded mb-6 border border-blue-200">
           <label class="font-bold text-lg text-blue-900 mb-2 block">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
           <select id="applyLevel" class="w-full md:w-1/3 p-2 border rounded-lg text-lg font-bold" required>
              <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
              <option value="‡∏°.1">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1</option>
              <option value="‡∏°.4">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4</option>
           </select>
        </div>

        <div class="section-head">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="input-group"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label><select id="serviceArea"><option>‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</option><option>‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</option></select></div>
          <div class="input-group"><label>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><select id="program"><option>‡∏ß‡∏¥‡∏ó‡∏¢‡πå-‡∏Ñ‡∏ì‡∏¥‡∏ï</option><option>‡∏®‡∏¥‡∏•‡∏õ‡πå-‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</option><option>‡∏®‡∏¥‡∏•‡∏õ‡πå-‡∏†‡∏≤‡∏©‡∏≤</option><option>‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option></select></div>
          <div class="input-group md:col-span-2"><label>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏°</label><input type="text" id="oldSchool"></div>
        </div>

        <div class="section-head">2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
           <div class="input-group md:col-span-2"><label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label><input id="idCard" readonly class="bg-gray-200 text-gray-500 cursor-not-allowed"></div>
           <div class="input-group"><label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label><select id="prefix"><option>‡∏î.‡∏ä.</option><option>‡∏î.‡∏ç.</option><option>‡∏ô‡∏≤‡∏¢</option><option>‡∏ô.‡∏™.</option></select></div>
           <div class="input-group"><label>‡∏ä‡∏∑‡πà‡∏≠</label><input id="name"></div>
           <div class="input-group"><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input id="surname"></div>
           <div class="input-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input id="phoneReg"></div>
           </div>

        <div class="mt-8 flex gap-4">
           <button type="submit" id="btnSubmit" class="flex-1 bg-blue-900 text-white font-bold py-4 rounded-lg hover:bg-blue-800 text-xl shadow-lg">
              ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
           </button>
           
           <a id="btnDownloadPDF" href="#" target="_blank" class="hidden flex-1 bg-green-600 text-white font-bold py-4 rounded-lg hover:bg-green-700 text-xl shadow-lg text-center flex items-center justify-center">
              üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå PDF
           </a>
        </div>
      </form>
    </div>
  </div>

  <script>
    // üî¥üî¥ URL SCRIPT üî¥üî¥
    const SCRIPT_URL = 'https://script.google.com/macros/s/xxxxxxxxxxxxxxxxx/exec'; 

    let allApplicants = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á
    let isAdminMode = false; // ‡∏ï‡∏±‡∏ß‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°

    function toggleAdminLogin() {
      document.getElementById('studentLoginBox').classList.toggle('hidden');
      document.getElementById('adminLoginBox').classList.toggle('hidden');
    }

    // --- LOGIN ---
    function handleLogin(e, role) {
      e.preventDefault();
      let payload = { action: 'login' };
      if (role === 'student') {
        payload.idCard = document.getElementById('loginIdCard').value;
      } else {
        payload.idCard = 'admin';
        payload.password = document.getElementById('adminPass').value;
      }
      
      fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
      .then(res => res.json())
      .then(json => {
        if (json.error) { alert(json.error); return; }
        
        document.getElementById('loginSection').classList.add('hidden');
        
        if (json.role === 'admin') {
           document.getElementById('adminSection').classList.remove('hidden');
           allApplicants = json.data; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö
           renderApplicants(allApplicants); // ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
        } else {
           isAdminMode = false;
           document.getElementById('formSection').classList.remove('hidden');
           document.getElementById('idCard').value = payload.idCard;
           if(json.found) populateForm(json.data);
        }
      });
    }

    // --- ADMIN FUNCTIONS ---
    function applyFilter(level) {
       // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°
       document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
       document.getElementById('filter-' + level).classList.add('active');

       if (level === 'all') {
          renderApplicants(allApplicants);
       } else if (level === 'M1') {
          const filtered = allApplicants.filter(item => item.level === '‡∏°.1');
          renderApplicants(filtered);
       } else if (level === 'M4') {
          const filtered = allApplicants.filter(item => item.level === '‡∏°.4');
          renderApplicants(filtered);
       }
    }

    function renderApplicants(data) {
       const tbody = document.getElementById('adminTableBody');
       tbody.innerHTML = '';
       if(!data.length) { tbody.innerHTML = '<tr><td colspan="4" class="p-4 text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; return; }
       
       data.forEach((r, index) => {
         // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° Edit ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á index ‡∏Ç‡∏≠‡∏á array ‡πÑ‡∏õ
         tbody.innerHTML += `
           <tr class="border-b hover:bg-gray-50">
             <td class="p-3"><span class="bg-gray-200 px-2 py-1 rounded text-xs font-bold">${r.level}</span></td>
             <td class="p-3 font-mono text-blue-800">${r.idCard}</td>
             <td class="p-3">${r.name}</td>
             <td class="p-3 text-center">
                <button onclick="openAdminEdit(${index})" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 shadow">
                   üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
             </td>
           </tr>
         `;
       });
    }

    // üü¢ ‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    function openAdminEdit(index) {
       isAdminMode = true;
       const data = allApplicants[index].fullData; // ‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏°‡∏≤

       // ‡∏ã‡πà‡∏≠‡∏ô Dashboard -> ‡πÇ‡∏ä‡∏ß‡πå Form
       document.getElementById('adminSection').classList.add('hidden');
       document.getElementById('formSection').classList.remove('hidden');
       
       // ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Admin Style
       document.getElementById('adminEditHeader').classList.remove('hidden');
       document.getElementById('editingName').innerText = data.prefix + data.name + " " + data.surname;
       document.getElementById('btnStudentLogout').classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á ‡∏ô‡∏£.
       document.getElementById('btnSubmit').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (Admin)";
       document.getElementById('btnSubmit').classList.replace('bg-blue-900', 'bg-yellow-600');

       // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
       populateForm(data);

       // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ PDF ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î
       const btnPDF = document.getElementById('btnDownloadPDF');
       if (allApplicants[index].pdfUrl) {
          btnPDF.href = allApplicants[index].pdfUrl;
          btnPDF.classList.remove('hidden');
       } else {
          btnPDF.classList.add('hidden');
       }
    }

    function closeAdminEdit() {
       // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°
       document.getElementById('appForm').reset();
       // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Dashboard
       document.getElementById('formSection').classList.add('hidden');
       document.getElementById('adminSection').classList.remove('hidden');
       document.getElementById('adminEditHeader').classList.add('hidden');
    }

    // --- FORM LOGIC ---
    function populateForm(data) {
       for (const key in data) {
          const el = document.getElementById(key);
          if (el && el.type !== 'checkbox') el.value = data[key];
       }
       // (‡πÉ‡∏™‡πà Logic Checkbox populate ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    }

    function submitForm(e) {
      e.preventDefault();
      const btn = document.getElementById('btnSubmit');
      btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'; btn.disabled = true;

      let data = {};
      document.querySelectorAll('input:not([type="checkbox"]), select').forEach(el => data[el.id] = el.value);
      // (‡∏£‡∏ß‡∏° Checkbox logic ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'save', data: data })
      })
      .then(res => res.json())
      .then(json => {
         if(json.success) {
            if (isAdminMode) {
               alert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! PDF ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß');
               // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° PDF ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á reload
               const btnPDF = document.getElementById('btnDownloadPDF');
               btnPDF.href = json.url;
               btnPDF.classList.remove('hidden');
            } else {
               if(confirm('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏î‡∏ï‡∏Å‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π PDF')) window.location.href = json.url;
            }
         } else {
            alert('Error: ' + json.error);
         }
      })
      .finally(() => { 
         btn.innerText = isAdminMode ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (Admin)' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'; 
         btn.disabled = false; 
      });
    }
    
    // (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Import Excel ‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏£‡∏±‡∏ö)
  </script>
</body>
</html>
