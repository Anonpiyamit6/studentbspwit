<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Whitelist + Admin)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; }
    .hidden { display: none !important; }
    .input-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #1e3a8a; }
    .input-group input, .input-group select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; }
    .section-head { background: #e0f2fe; padding: 10px; font-weight: bold; color: #0c4a6e; border-left: 4px solid #0284c7; margin-top: 20px; margin-bottom: 10px; }
  </style>
</head>
<body class="bg-gray-100">

  <div id="loginSection" class="min-h-screen flex flex-col md:flex-row">
    <div class="md:w-1/2 bg-blue-900 flex flex-col justify-center items-center text-white p-10 relative">
      <h1 class="text-4xl font-bold mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
      <h2 class="text-2xl opacity-90">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</h2>
      <div class="mt-8 text-center text-blue-200">
        <p>‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
      </div>
      <button onclick="toggleAdminLogin()" class="absolute bottom-4 left-4 text-blue-400 text-xs hover:text-white">
        ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà
      </button>
    </div>
    
    <div class="md:w-1/2 bg-white flex flex-col justify-center items-center p-8">
      <div class="w-full max-w-md">
        
        <div id="studentLoginBox">
          <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</h3>
          <form onsubmit="handleLogin(event, 'student')" class="space-y-4">
            <div>
              <label class="block text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
              <input type="text" id="loginIdCard" maxlength="13" required 
                     class="w-full p-4 border border-gray-300 rounded-lg text-xl text-center tracking-widest"
                     placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å">
            </div>
            <button type="submit" id="btnLoginStudent" class="w-full bg-blue-900 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-800 transition">
              ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£
            </button>
          </form>
        </div>

        <div id="adminLoginBox" class="hidden">
          <h3 class="text-2xl font-bold text-red-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà)</h3>
          <form onsubmit="handleLogin(event, 'admin')" class="space-y-4">
            <div>
              <label class="block text-gray-700 mb-2">Username</label>
              <input type="text" id="adminUser" value="admin" readonly class="w-full p-3 bg-gray-100 rounded border">
            </div>
            <div>
              <label class="block text-gray-700 mb-2">Password</label>
              <input type="password" id="adminPass" required class="w-full p-3 border rounded">
            </div>
            <button type="submit" id="btnLoginAdmin" class="w-full bg-red-800 text-white py-3 rounded-lg font-bold hover:bg-red-700">
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin
            </button>
            <button type="button" onclick="toggleAdminLogin()" class="w-full text-gray-500 mt-2 text-sm">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
          </form>
        </div>

      </div>
    </div>
  </div>

  <div id="formSection" class="hidden p-4 md:p-8 max-w-5xl mx-auto">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-xl">
      <div class="flex justify-between items-center mb-6 border-b pb-4">
        <h2 class="text-2xl font-bold text-blue-900">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h2>
        <button onclick="location.reload()" class="text-red-600 underline">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
      
      <form id="appForm" onsubmit="submitForm(event)">
         <div class="text-center p-10 bg-gray-50 border border-dashed border-gray-400">
            (‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° Standard Form ‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß) <br>
            <input type="hidden" id="idCard"> </div>
         <button type="submit" id="btnSubmit" class="w-full bg-blue-900 text-white font-bold py-4 rounded-lg mt-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </form>

    </div>
  </div>

  <div id="adminSection" class="hidden p-6 max-w-6xl mx-auto">
    <div class="bg-white p-8 rounded-xl shadow-xl">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h2>
        <button onclick="location.reload()" class="bg-gray-500 text-white px-4 py-2 rounded">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-gray-200 text-gray-700">
              <th class="p-3 border">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
              <th class="p-3 border">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£</th>
              <th class="p-3 border">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
              <th class="p-3 border">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (PDF)</th>
            </tr>
          </thead>
          <tbody id="adminTableBody">
            </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // üî¥üî¥üî¥ ‡πÉ‡∏™‡πà URL ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üî¥üî¥üî¥
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxtWZwXSFcbdrrPZSLrs4kmEDYB4fqx3MxUs0Wo40lgkAyIi_6C-j0AJ3YZgWOBJ16AHw/exec'; 

    function toggleAdminLogin() {
      document.getElementById('studentLoginBox').classList.toggle('hidden');
      document.getElementById('adminLoginBox').classList.toggle('hidden');
    }

    function handleLogin(e, role) {
      e.preventDefault();
      
      let payload = { action: 'login' };
      let btn;

      if (role === 'student') {
        const id = document.getElementById('loginIdCard').value;
        if(id.length !== 13) { alert('‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 13 ‡∏´‡∏•‡∏±‡∏Å'); return; }
        payload.idCard = id;
        btn = document.getElementById('btnLoginStudent');
      } else {
        payload.idCard = 'admin';
        payload.password = document.getElementById('adminPass').value;
        btn = document.getElementById('btnLoginAdmin');
      }

      btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...'; btn.disabled = true;

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(json => {
        if (json.error) {
           alert('‚ùå ' + json.error);
        } else {
           // Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
           document.getElementById('loginSection').classList.add('hidden');
           
           if (json.role === 'admin') {
             // ‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤ Admin
             document.getElementById('adminSection').classList.remove('hidden');
             renderAdminTable(json.data);
           } else {
             // ‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤ Student Form
             document.getElementById('formSection').classList.remove('hidden');
             document.getElementById('idCard').value = payload.idCard; // ‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£
             
             if (json.found) {
               alert('‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß');
               populateForm(json.data); // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
             } else {
               alert('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
             }
           }
        }
      })
      .catch(err => alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + err))
      .finally(() => { btn.innerText = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'; btn.disabled = false; });
    }

    function renderAdminTable(data) {
      const tbody = document.getElementById('adminTableBody');
      tbody.innerHTML = '';
      if(data.length === 0) { tbody.innerHTML = '<tr><td colspan="4" class="p-4 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</td></tr>'; return; }

      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = "border-b hover:bg-gray-50";
        tr.innerHTML = `
          <td class="p-3">${new Date(row.timestamp).toLocaleString('th-TH')}</td>
          <td class="p-3">${row.idCard}</td>
          <td class="p-3">${row.name}</td>
          <td class="p-3">
             <a href="${row.pdfUrl}" target="_blank" class="text-blue-600 hover:underline flex items-center gap-1">
               üìÑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π PDF
             </a>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô submitForm ‡πÅ‡∏•‡∏∞ populateForm (‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö)
    // ...
  </script>
</body>
</html>
