<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; background: #e2e8f0; }
    .hidden { display: none !important; }
    
    /* Paper Effect */
    .a4-paper { 
       background: white; width: 210mm; min-height: 297mm; margin: 20px auto; 
       padding: 15mm 20mm; position: relative; box-shadow: 0 0 15px rgba(0,0,0,0.1); 
    }
    @media (max-width: 768px) { .a4-paper { width: 100%; padding: 15px; } }

    /* Custom Inputs mimicking dots/lines */
    .dotted-line { 
       border: none; border-bottom: 1px dotted #444; width: 100%; 
       outline: none; color: #1e3a8a; font-weight: bold; padding: 0 5px; background: transparent;
    }
    .check-box { 
       appearance: none; width: 18px; height: 18px; border: 1px solid #444; 
       margin-right: 8px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer;
    }
    .check-box:checked { background: #1e3a8a; border-color: #1e3a8a; }
    .check-box:checked::after { content: '‚úì'; color: white; font-size: 14px; }
    
    /* ID Card Boxes */
    .id-box-group { display: flex; gap: 8px; align-items: center; }
    .id-box { 
       border: 1px solid #444; width: 20px; height: 26px; text-align: center; 
       font-weight: bold; border-radius: 2px; font-size: 14px;
    }
    .id-segment { display: flex; gap: 1px; }

    /* Photo Upload Box */
    .photo-upload-box {
       width: 35mm; height: 45mm; border: 1px solid #000; 
       display: flex; flex-direction: column; justify-content: center; align-items: center;
       cursor: pointer; position: relative; overflow: hidden; background: #f8fafc;
    }
    .photo-upload-box:hover { background: #f1f5f9; }
    .photo-preview { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
  </style>
</head>
<body>

  <div id="loginSection" class="min-h-screen flex items-center justify-center bg-blue-900 p-4">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full text-center">
       <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Emblem_of_the_Ministry_of_Education_of_Thailand.svg/1200px-Emblem_of_the_Ministry_of_Education_of_Thailand.svg.png" class="h-20 mx-auto mb-4">
       <h1 class="text-2xl font-bold text-gray-800 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
       <p class="text-gray-500 mb-6">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
       
       <div id="roleStudent">
          <input type="text" id="loginUser" maxlength="13" class="w-full border-2 border-blue-100 rounded-lg p-3 text-center text-xl tracking-widest mb-4 focus:border-blue-500 outline-none" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å">
          <button onclick="handleLogin('student')" id="btnStu" class="w-full bg-blue-800 text-white py-3 rounded-lg font-bold hover:bg-blue-900 transition">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          <div class="mt-4 text-xs text-gray-400 cursor-pointer underline" onclick="toggleRole()">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</div>
       </div>

       <div id="roleAdmin" class="hidden">
          <input type="text" id="admUser" placeholder="Username" class="w-full border p-2 rounded mb-2">
          <input type="password" id="admPass" placeholder="Password" class="w-full border p-2 rounded mb-4">
          <button onclick="handleLogin('admin')" id="btnAdm" class="w-full bg-red-700 text-white py-3 rounded hover:bg-red-800 font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (Admin)</button>
          <div class="mt-4 text-xs text-gray-400 cursor-pointer underline" onclick="toggleRole()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</div>
       </div>
    </div>
  </div>

  <div id="formSection" class="hidden pb-20">
    <form id="appForm" onsubmit="submitForm(event)">
      
      <div class="a4-paper">
         
         <div class="flex justify-between items-start mb-6 relative">
            <div class="flex-1 text-center pt-4">
               <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Emblem_of_the_Ministry_of_Education_of_Thailand.svg/1200px-Emblem_of_the_Ministry_of_Education_of_Thailand.svg.png" class="h-20 mx-auto mb-2">
               <h2 class="text-xl font-bold">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1</h2>
               <h3 class="font-bold">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå</h3>
               <p class="text-sm">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå</p>
            </div>
            
            <div class="absolute right-0 top-0">
               <div class="text-xs text-center mb-1">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ <div class="border border-black px-2 inline-block h-6 w-16"></div></div>
               <div class="photo-upload-box" onclick="document.getElementById('fileInput').click()">
                  <span class="text-xs text-gray-400 text-center z-0 px-2">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢<br>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br>1-1.5 ‡∏ô‡∏¥‡πâ‡∏ß<br>(‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î)</span>
                  <img id="imgPreview" class="photo-preview hidden">
                  <input type="file" id="fileInput" class="hidden" accept="image/*" onchange="previewImage(this)">
               </div>
            </div>
         </div>

         <div class="mb-6 text-sm ml-4">
            <b>‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á</b>
            <ol class="list-decimal list-inside ml-2 space-y-1">
               <li>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏£‡∏£‡∏à‡∏á</li>
               <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</li>
            </ol>
         </div>

         <div class="mb-4">
            <h3 class="font-bold border-b border-black inline-block mb-2">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
            <div class="ml-4 space-y-2">
               <label class="flex items-start cursor-pointer"><input type="radio" name="area_status" value="‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï" class="check-box mt-1"> ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ï.‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î‡∏ô‡∏û‡∏Ñ‡∏∏‡∏ì, ‡∏ï.‡∏û‡∏á‡∏®‡πå‡∏õ‡∏£‡∏∞‡∏®‡∏≤‡∏™‡∏ô‡πå, ‡∏ï.‡πÅ‡∏°‡πà‡∏£‡∏≥‡∏û‡∏∂‡∏á, ‡∏ï.‡∏ó‡∏≠‡∏á‡∏°‡∏á‡∏Ñ‡∏•, ‡∏ï.‡∏£‡πà‡∏≠‡∏ô‡∏ó‡∏≠‡∏á)</label>
               <label class="flex items-center cursor-pointer"><input type="radio" name="area_status" value="‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï" class="check-box"> ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
            </div>
         </div>

         <div class="mb-6 flex items-baseline">
            <span class="font-bold mr-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
            <input type="text" name="old_school" class="dotted-line">
         </div>

         <div class="mb-6">
            <h3 class="font-bold mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1 (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
            <div class="grid grid-cols-2 gap-4 ml-4">
               <label class="flex items-center cursor-pointer"><input type="radio" name="program_select" value="‡∏ß‡∏¥‡∏ó‡∏¢‡πå-‡∏Ñ‡∏ì‡∏¥‡∏ï" class="check-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡πå - ‡∏Ñ‡∏ì‡∏¥‡∏ï</label>
               <label class="flex items-center cursor-pointer"><input type="radio" name="program_select" value="EIS" class="check-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô EIS</label>
               <label class="flex items-center cursor-pointer"><input type="radio" name="program_select" value="S&M" class="check-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô S&M</label>
               <label class="flex items-center cursor-pointer"><input type="radio" name="program_select" value="GATE" class="check-box"> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô GATE</label>
            </div>
         </div>

         <div class="mb-6">
            <h3 class="font-bold mb-2">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h3>
            <div class="space-y-1 ml-4 text-sm">
               <div class="flex justify-between"><label><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="check-box"> 1. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
               <div class="flex justify-between"><label><input type="checkbox" name="docs" value="‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£" class="check-box"> 2. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
               <div class="flex justify-between"><label><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏¥‡∏î‡∏≤" class="check-box"> 3. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏¥‡∏î‡∏≤‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
               <div class="flex justify-between"><label><input type="checkbox" name="docs" value="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡∏£‡∏î‡∏≤" class="check-box"> 4. ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡∏£‡∏î‡∏≤‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
               <div class="flex justify-between"><label><input type="checkbox" name="docs" value="‡∏õ‡∏û.1" class="check-box"> 5. ‡∏õ‡∏û.1 ‡∏´‡∏£‡∏∑‡∏≠ ‡∏õ‡∏û.7</label> <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 1 ‡∏â‡∏ö‡∏±‡∏ö</span></div>
               <div class="flex items-center w-full">
                  <input type="checkbox" name="docs" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="check-box"> 6. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏) <input type="text" name="doc_other" class="dotted-line w-1/2 mx-2">
               </div>
            </div>
         </div>

         <div class="mb-2">
            <h3 class="font-bold mb-2">(1) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
            <div class="flex flex-wrap gap-2 mb-2 items-baseline">
               <span>‡∏ä‡∏∑‡πà‡∏≠ (‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤)</span>
               <select name="prefix" class="border-b border-dotted border-black bg-transparent outline-none font-bold"><option>‡∏î.‡∏ä.</option><option>‡∏î.‡∏ç.</option><option>‡∏ô‡∏≤‡∏¢</option><option>‡∏ô.‡∏™.</option></select>
               <input type="text" name="name_th" class="dotted-line w-1/3">
               <span>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
               <input type="text" name="surname_th" class="dotted-line w-1/3">
            </div>
            
            <div class="flex items-center gap-4 mb-2">
               <span class="font-bold w-40">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</span>
               <div class="id-box-group" id="idCardContainer">
                  </div>
               <input type="hidden" name="idCard" id="realIdCard"> </div>

            <div class="flex items-baseline mb-2">
               <span class="w-28">‡∏ß‡∏±‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</span>
               <input type="date" name="dob" class="dotted-line w-40">
               <span class="ml-4">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î</span>
               <input type="text" name="birth_hosp" class="dotted-line w-1/3">
            </div>
            
            <div class="flex items-baseline mb-2 gap-2">
               <span>‡∏ï‡∏≥‡∏ö‡∏•</span><input name="birth_tumbon" class="dotted-line flex-1">
               <span>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</span><input name="birth_amphoe" class="dotted-line flex-1">
               <span>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span><input name="birth_province" class="dotted-line flex-1">
            </div>
            
            <div class="flex items-baseline gap-2">
               <span class="w-16">‡∏´‡∏°‡∏π‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î</span><input name="blood" class="dotted-line w-16">
               <span class="w-16">‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥</span><input name="nation" class="dotted-line w-20">
               <span class="w-16">‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏≤‡∏ï‡∏¥</span><input name="race" class="dotted-line w-20">
               <span class="w-16">‡∏®‡∏≤‡∏™‡∏ô‡∏≤</span><input name="religion" class="dotted-line w-20">
            </div>
         </div>

         <div class="absolute bottom-5 right-10 text-xs text-gray-400">‡∏´‡∏ô‡πâ‡∏≤ 1</div>
      </div>
      
      <div class="fixed bottom-0 left-0 w-full bg-white border-t p-4 flex justify-center z-50">
         <button type="submit" id="btnSave" class="bg-blue-900 text-white text-lg font-bold py-2 px-10 rounded-full shadow-lg hover:bg-blue-800 transition transform hover:scale-105">
             ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
         </button>
      </div>

    </form>
  </div>

  <script>
    // üî¥üî¥ URL SCRIPT ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üî¥üî¥
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxtWZwXSFcbdrrPZSLrs4kmEDYB4fqx3MxUs0Wo40lgkAyIi_6C-j0AJ3YZgWOBJ16AHw/exec'; 

    let photoBase64 = null;
    let existingPhoto = null;

    // --- Generate ID Card Boxes ---
    function renderIdBoxes() {
       const c = document.getElementById('idCardContainer');
       const structure = [1, 4, 5, 2, 1]; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏∏‡∏î
       let idx = 0;
       structure.forEach((count, groupIndex) => {
          const div = document.createElement('div');
          div.className = 'id-segment';
          for(let i=0; i<count; i++) {
             const inp = document.createElement('input');
             inp.className = 'id-box';
             inp.maxLength = 1;
             inp.dataset.idx = idx;
             inp.onkeyup = (e) => handleIdInput(e, inp);
             div.appendChild(inp);
             idx++;
          }
          c.appendChild(div);
       });
    }
    renderIdBoxes();

    function handleIdInput(e, el) {
       // Allow only numbers
       el.value = el.value.replace(/[^0-9]/g, '');
       const next = document.querySelector(`input[data-idx="${parseInt(el.dataset.idx)+1}"]`);
       const prev = document.querySelector(`input[data-idx="${parseInt(el.dataset.idx)-1}"]`);
       
       if(el.value.length === 1 && next) next.focus();
       if(e.key === 'Backspace' && el.value === '' && prev) prev.focus();
       
       // Update hidden input
       updateRealId();
    }

    function updateRealId() {
       let val = '';
       document.querySelectorAll('.id-box').forEach(i => val += i.value);
       document.getElementById('realIdCard').value = val;
    }

    function fillIdBoxes(idStr) {
       const boxes = document.querySelectorAll('.id-box');
       const chars = idStr.split('');
       boxes.forEach((b, i) => { if(chars[i]) b.value = chars[i]; });
       updateRealId();
    }

    // --- Image Preview ---
    function previewImage(input) {
       if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
             document.getElementById('imgPreview').src = e.target.result;
             document.getElementById('imgPreview').classList.remove('hidden');
             photoBase64 = e.target.result; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ‡∏™‡πà‡∏á
          }
          reader.readAsDataURL(input.files[0]);
       }
    }

    // --- Login & Submit ---
    function toggleRole() {
       document.getElementById('roleStudent').classList.toggle('hidden');
       document.getElementById('roleAdmin').classList.toggle('hidden');
    }

    function handleLogin(role) {
       const u = role==='student'?document.getElementById('loginUser').value : document.getElementById('admUser').value;
       const p = role==='student'?'':document.getElementById('admPass').value;
       const btn = role==='student'?document.getElementById('btnStu'):document.getElementById('btnAdm');
       
       btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'login', username:u, password:p})})
       .then(r=>r.json()).then(res => {
          if(res.success === false) return alert(res.error);
          document.getElementById('loginSection').classList.add('hidden');
          
          if(res.role === 'admin') {
             // (‡∏™‡πà‡∏ß‡∏ô Admin ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
             alert('Welcome Admin'); 
          } else {
             document.getElementById('formSection').classList.remove('hidden');
             fillIdBoxes(u); // ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏•‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
             if(res.data) {
                populate(res.data);
                if(res.data.photoUrl) {
                   document.getElementById('imgPreview').src = res.data.photoUrl;
                   document.getElementById('imgPreview').classList.remove('hidden');
                   existingPhoto = res.data.photoUrl;
                }
             }
          }
       }).catch(e=>alert(e)).finally(()=> btn.innerText = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
    }

    function submitForm(e) {
       e.preventDefault();
       const btn = document.getElementById('btnSave');
       btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'; btn.disabled = true;

       const fd = {};
       // Collect standard inputs
       document.querySelectorAll('input:not(.id-box), select').forEach(el => {
          if(el.type==='radio' && el.checked) fd[el.name]=el.value;
          else if(el.type==='checkbox' && el.checked) {
             if(!fd[el.name]) fd[el.name]=[]; fd[el.name].push(el.value);
          } else if(el.type!=='radio' && el.type!=='checkbox' && el.type!=='file') {
             fd[el.name] = el.value;
          }
       });
       if(fd.docs) fd.docs = fd.docs.join(', ');

       // Add Photo Info
       if(photoBase64) fd.photoBase64 = photoBase64;
       if(existingPhoto) fd.existingPhoto = existingPhoto;

       fetch(SCRIPT_URL, {method:'POST', body:JSON.stringify({action:'save', data:fd})})
       .then(r=>r.json()).then(res => {
          if(res.success) alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
          else alert('Error: '+res.error);
       }).finally(()=> { btn.innerText='‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'; btn.disabled=false; });
    }

    function populate(d) {
       // (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏ä‡πâ populate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°)
       Object.keys(d).forEach(k => {
          const el = document.getElementsByName(k)[0];
          if(el && el.type!=='file') el.value = d[k];
          // ‡πÄ‡∏û‡∏¥‡πà‡∏° logic radio/checkbox ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
       });
    }
  </script>
</body>
</html>
