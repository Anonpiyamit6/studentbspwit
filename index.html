<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบรับสมัครนักเรียนออนไลน์ - Modern Design</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            prompt: ['Prompt', 'sans-serif'],
            sarabun: ['Sarabun', 'sans-serif'],
          },
          colors: {
            primary: '#059669', // Emerald 600
            secondary: '#0d9488', // Teal 600
            surface: '#ffffff',
            background: '#f0f9ff', // Light Blue/Gray
          }
        }
      }
    }
  </script>

  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: #f1f5f9;
      background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
      background-size: 24px 24px;
    }
    
    h1, h2, h3, h4, h5, h6, .font-heading {
      font-family: 'Prompt', sans-serif;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* Glass Effect for Cards */
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Transition for Views */
    .view { display: none; opacity: 0; transform: translateY(10px); transition: all 0.4s ease-out; }
    .view.active { display: block; opacity: 1; transform: translateY(0); }

    /* Input Focus Styles */
    .input-modern {
      @apply w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 text-slate-700 focus:bg-white focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200 outline-none;
    }

    /* Button Styles */
    .btn-gradient {
      @apply bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-prompt font-medium py-3 px-6 rounded-xl shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 hover:-translate-y-0.5 transition-all duration-300;
    }
    
    .btn-secondary-modern {
      @apply bg-white text-slate-600 font-prompt font-medium py-3 px-6 rounded-xl border border-slate-200 hover:bg-slate-50 hover:text-slate-800 transition-all duration-200;
    }

    /* Loader */
    .loader {
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top: 3px solid #fff;
      width: 20px; height: 20px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="text-slate-600 antialiased min-h-screen flex flex-col">

  <nav class="sticky top-0 z-50 glass-card shadow-sm border-b border-slate-100/50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-20">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white text-xl shadow-md">
            <i class="fa-solid fa-graduation-cap"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold text-slate-800 font-heading leading-tight">ระบบรับสมัครนักเรียน</h1>
            <p class="text-xs text-slate-500 font-medium">โรงเรียนบางสะพานวิทยา</p>
          </div>
        </div>
        <div>
          </div>
      </div>
    </div>
  </nav>

  <main class="flex-grow container mx-auto px-4 py-8 max-w-5xl">
    
    <div id="studentLoginView" class="view active">
      <div class="max-w-md mx-auto mt-10">
        <div class="glass-card rounded-2xl shadow-xl p-8 border-t-4 border-emerald-500">
          <div class="text-center mb-8">
            <h2 class="text-2xl font-bold text-slate-800 font-heading">เข้าสู่ระบบรับสมัคร</h2>
            <p class="text-slate-500 mt-2">กรอกเลขบัตรประชาชนเพื่อเริ่มต้น</p>
          </div>
          
          <form id="studentLoginForm" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2 font-heading">เลขประจำตัวประชาชน (13 หลัก)</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fa-regular fa-id-card text-slate-400"></i>
                </div>
                <input type="text" id="studentIdCard" class="input-modern pl-10" maxlength="13" placeholder="xxxxxxxxxxxxx" required>
              </div>
            </div>
            
            <button type="submit" class="btn-gradient w-full flex justify-center items-center gap-2">
              <span>เข้าสู่ระบบ / สมัครเรียน</span>
              <i class="fa-solid fa-arrow-right"></i>
            </button>
          </form>

          <div class="mt-8 pt-6 border-t border-slate-100 text-center">
            <button onclick="showView('adminLoginView')" class="text-sm text-slate-400 hover:text-emerald-600 transition-colors font-medium">
              <i class="fa-solid fa-lock mr-1"></i> สำหรับเจ้าหน้าที่
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="adminLoginView" class="view">
      <div class="max-w-md mx-auto mt-10">
        <div class="glass-card rounded-2xl shadow-xl p-8 border-t-4 border-slate-500">
          <div class="text-center mb-8">
            <div class="w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-600">
               <i class="fa-solid fa-user-shield text-xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-800 font-heading">ผู้ดูแลระบบ</h2>
          </div>
          
          <form id="adminLoginForm" class="space-y-5">
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2 font-heading">Username</label>
              <input type="text" id="adminUsername" class="input-modern" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2 font-heading">Password</label>
              <input type="password" id="adminPassword" class="input-modern" required>
            </div>
            
            <button type="submit" class="w-full bg-slate-800 text-white font-prompt font-medium py-3 px-6 rounded-xl shadow-lg hover:bg-slate-900 transition-all">
              เข้าสู่ระบบ
            </button>
          </form>
          
          <div class="mt-6 text-center">
             <button onclick="showView('studentLoginView')" class="text-sm text-slate-500 hover:text-slate-800">
               <i class="fa-solid fa-arrow-left mr-1"></i> กลับหน้าหลัก
             </button>
          </div>
        </div>
      </div>
    </div>

    <div id="applicationFormView" class="view">
      
      <div class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
           <h2 class="text-3xl font-bold text-slate-800 font-heading">แบบฟอร์มรับสมัคร</h2>
           <p class="text-slate-500">กรอกข้อมูลให้ครบถ้วนเพื่อการพิจารณา</p>
        </div>
        <button onclick="logout()" class="btn-secondary-modern text-sm py-2 px-4">
          <i class="fa-solid fa-sign-out-alt mr-1"></i> ยกเลิก
        </button>
      </div>

      <form id="applicationForm" class="space-y-6">
        
        <div class="glass-card rounded-2xl shadow-sm p-6 md:p-8 relative overflow-hidden">
          <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
          <h3 class="text-xl font-bold text-slate-800 font-heading mb-6 flex items-center gap-2">
            <i class="fa-solid fa-user text-emerald-500"></i> ข้อมูลส่วนตัว
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-6">
            <div class="md:col-span-1 lg:col-span-2">
              <label class="block text-sm font-medium text-slate-700 mb-2">คำนำหน้า</label>
              <select id="prefix" class="input-modern" required>
                <option value="">เลือก</option>
                <option value="ด.ช.">ด.ช.</option>
                <option value="ด.ญ.">ด.ญ.</option>
                <option value="นาย">นาย</option>
                <option value="นางสาว">นางสาว</option>
              </select>
            </div>
            <div class="md:col-span-1 lg:col-span-4">
               <label class="block text-sm font-medium text-slate-700 mb-2">เลขบัตรประชาชน</label>
               <input type="text" id="idCard" class="input-modern bg-slate-100 text-slate-500 cursor-not-allowed" readonly>
            </div>
            <div class="md:col-span-1 lg:col-span-3">
               <label class="block text-sm font-medium text-slate-700 mb-2">ชื่อ (ไทย)</label>
               <input type="text" id="firstName" class="input-modern" required>
            </div>
            <div class="md:col-span-1 lg:col-span-3">
               <label class="block text-sm font-medium text-slate-700 mb-2">นามสกุล (ไทย)</label>
               <input type="text" id="lastName" class="input-modern" required>
            </div>
            
            <div class="md:col-span-1 lg:col-span-6">
               <label class="block text-sm font-medium text-slate-700 mb-2">ชื่อ (Eng)</label>
               <input type="text" id="firstNameEn" class="input-modern">
            </div>
            <div class="md:col-span-1 lg:col-span-6">
               <label class="block text-sm font-medium text-slate-700 mb-2">นามสกุล (Eng)</label>
               <input type="text" id="lastNameEn" class="input-modern">
            </div>

            <div class="md:col-span-1 lg:col-span-4">
              <label class="block text-sm font-medium text-slate-700 mb-2">วันเกิด</label>
              <input type="date" id="birthDate" class="input-modern" required>
            </div>
            <div class="md:col-span-1 lg:col-span-4">
              <label class="block text-sm font-medium text-slate-700 mb-2">โรงพยาบาลที่เกิด</label>
              <input type="text" id="birthHospital" class="input-modern">
            </div>
             <div class="md:col-span-1 lg:col-span-4">
              <label class="block text-sm font-medium text-slate-700 mb-2">หมู่เลือด</label>
              <select id="bloodType" class="input-modern">
                 <option value="-">-</option><option value="A">A</option><option value="B">B</option><option value="O">O</option><option value="AB">AB</option>
              </select>
            </div>
            
             <div class="md:col-span-1 lg:col-span-4">
              <label class="block text-sm font-medium text-slate-700 mb-2">สัญชาติ</label>
              <input type="text" id="nationality" class="input-modern" value="ไทย">
            </div>
             <div class="md:col-span-1 lg:col-span-4">
              <label class="block text-sm font-medium text-slate-700 mb-2">เชื้อชาติ</label>
              <input type="text" id="ethnicity" class="input-modern" value="ไทย">
            </div>
             <div class="md:col-span-1 lg:col-span-4">
              <label class="block text-sm font-medium text-slate-700 mb-2">ศาสนา</label>
              <input type="text" id="religion" class="input-modern" value="พุทธ">
            </div>
          </div>
        </div>

        <div class="glass-card rounded-2xl shadow-sm p-6 md:p-8 relative overflow-hidden">
          <div class="absolute top-0 left-0 w-1 h-full bg-teal-500"></div>
          <h3 class="text-xl font-bold text-slate-800 font-heading mb-6 flex items-center gap-2">
            <i class="fa-solid fa-map-location-dot text-teal-500"></i> ที่อยู่ & การศึกษา
          </h3>
          
           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700 mb-3">พื้นที่บริการ</label>
                <div class="flex gap-4">
                  <label class="flex items-center p-3 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-colors w-full md:w-auto">
                    <input type="radio" name="serviceArea" value="ในเขต" checked class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                    <span class="ml-2">ในเขตพื้นที่บริการ</span>
                  </label>
                   <label class="flex items-center p-3 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-colors w-full md:w-auto">
                    <input type="radio" name="serviceArea" value="นอกเขต" class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                    <span class="ml-2">นอกเขตพื้นที่บริการ</span>
                  </label>
                </div>
             </div>
             
             <div><label class="block text-sm font-medium text-slate-700 mb-2">ตำบล</label><input type="text" id="subdistrict" class="input-modern"></div>
             <div><label class="block text-sm font-medium text-slate-700 mb-2">อำเภอ</label><input type="text" id="district" class="input-modern"></div>
             <div><label class="block text-sm font-medium text-slate-700 mb-2">จังหวัด</label><input type="text" id="province" class="input-modern"></div>
             
             <div><label class="block text-sm font-medium text-slate-700 mb-2">โรงเรียนเดิม</label><input type="text" id="previousSchool" class="input-modern" required></div>
             <div><label class="block text-sm font-medium text-slate-700 mb-2">เกรดเฉลี่ย (GPA)</label><input type="number" step="0.01" id="gpa" class="input-modern" required></div>
           </div>
        </div>

        <div class="glass-card rounded-2xl shadow-sm p-6 md:p-8 relative overflow-hidden">
          <div class="absolute top-0 left-0 w-1 h-full bg-indigo-500"></div>
           <h3 class="text-xl font-bold text-slate-800 font-heading mb-6 flex items-center gap-2">
            <i class="fa-solid fa-graduation-cap text-indigo-500"></i> ข้อมูลการสมัคร
          </h3>

          <div class="space-y-6">
            <div>
               <label class="block text-sm font-medium text-slate-700 mb-2">ระดับชั้น</label>
               <select id="gradeLevel" class="input-modern" required>
                  <option value="ม.1">มัธยมศึกษาปีที่ 1</option>
                  <option value="ม.4">มัธยมศึกษาปีที่ 4</option>
               </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-3">แผนการเรียน / โครงการ</label>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <label class="relative flex items-start p-4 border rounded-xl cursor-pointer hover:bg-indigo-50 border-slate-200 transition-all">
                  <div class="flex items-center h-5">
                    <input type="radio" name="program" value="วิทย์-คณิต" checked class="w-4 h-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                  </div>
                  <div class="ml-3 text-sm">
                    <span class="font-medium text-slate-900 block">วิทย์-คณิต</span>
                    <span class="text-slate-500 text-xs">เน้นวิทยาศาสตร์และคณิตศาสตร์เข้มข้น</span>
                  </div>
                </label>
                
                 <label class="relative flex items-start p-4 border rounded-xl cursor-pointer hover:bg-indigo-50 border-slate-200 transition-all">
                  <div class="flex items-center h-5">
                    <input type="radio" name="program" value="S&M" class="w-4 h-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                  </div>
                  <div class="ml-3 text-sm">
                    <span class="font-medium text-slate-900 block">S&M (Science & Math)</span>
                    <span class="text-slate-500 text-xs">ห้องเรียนพิเศษ</span>
                  </div>
                </label>
                
                 <label class="relative flex items-start p-4 border rounded-xl cursor-pointer hover:bg-indigo-50 border-slate-200 transition-all">
                  <div class="flex items-center h-5">
                    <input type="radio" name="program" value="EIS" class="w-4 h-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                  </div>
                  <div class="ml-3 text-sm">
                    <span class="font-medium text-slate-900 block">EIS (English Intensive)</span>
                    <span class="text-slate-500 text-xs">จัดการเรียนการสอนเป็นภาษาอังกฤษ</span>
                  </div>
                </label>
                
                 <label class="relative flex items-start p-4 border rounded-xl cursor-pointer hover:bg-indigo-50 border-slate-200 transition-all">
                  <div class="flex items-center h-5">
                    <input type="radio" name="program" value="GATE" class="w-4 h-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                  </div>
                  <div class="ml-3 text-sm">
                    <span class="font-medium text-slate-900 block">GATE (Gifted)</span>
                    <span class="text-slate-500 text-xs">สำหรับผู้มีความสามารถพิเศษ</span>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="glass-card rounded-2xl shadow-sm p-6 md:p-8 relative overflow-hidden">
           <div class="absolute top-0 left-0 w-1 h-full bg-orange-500"></div>
           <h3 class="text-xl font-bold text-slate-800 font-heading mb-6 flex items-center gap-2">
            <i class="fa-solid fa-paperclip text-orange-500"></i> เอกสารแนบ
          </h3>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
             <label class="flex items-center space-x-3 p-3 bg-slate-50 rounded-lg">
               <input type="checkbox" name="documents" value="ทะเบียนบ้าน" class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300">
               <span class="text-slate-700">ทะเบียนบ้าน</span>
             </label>
             <label class="flex items-center space-x-3 p-3 bg-slate-50 rounded-lg">
               <input type="checkbox" name="documents" value="สูติบัตร" class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300">
               <span class="text-slate-700">สูติบัตร</span>
             </label>
             <label class="flex items-center space-x-3 p-3 bg-slate-50 rounded-lg">
               <input type="checkbox" name="documents" value="ปพ.1" class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300">
               <span class="text-slate-700">ปพ.1 / ปพ.7</span>
             </label>
              <label class="flex items-center space-x-3 p-3 bg-slate-50 rounded-lg">
               <input type="checkbox" id="otherDocCheck" class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300">
               <span class="text-slate-700">อื่นๆ</span>
             </label>
          </div>
          <div id="otherDocContainer" class="mt-4 hidden">
             <input type="text" id="otherDocument" class="input-modern" placeholder="ระบุชื่อเอกสารอื่นๆ">
          </div>
        </div>

        <div class="flex justify-center pt-6">
           <button type="submit" id="submitBtn" class="btn-gradient px-12 py-4 text-lg w-full md:w-auto shadow-emerald-500/40 hover:shadow-emerald-500/50">
             <i class="fa-solid fa-save mr-2"></i> บันทึกข้อมูลการสมัคร
           </button>
        </div>
      </form>
    </div>

    <div id="adminDashboardView" class="view">
        <div class="mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
              <h2 class="text-3xl font-bold text-slate-800 font-heading">Dashboard</h2>
              <p class="text-slate-500">ภาพรวมข้อมูลการรับสมัคร</p>
            </div>
            <button onclick="logout()" class="btn-secondary-modern">
               <i class="fa-solid fa-sign-out-alt mr-1"></i> ออกจากระบบ
            </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card rounded-2xl p-6 shadow-sm border-b-4 border-blue-500 flex items-center justify-between">
                <div>
                   <p class="text-slate-500 text-sm font-medium">ผู้สมัครทั้งหมด</p>
                   <h1 id="totalApplicants" class="text-4xl font-bold text-slate-800 mt-1">0</h1>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                   <i class="fa-solid fa-users text-xl"></i>
                </div>
            </div>
             <div class="glass-card rounded-2xl p-6 shadow-sm border-b-4 border-purple-500 flex items-center justify-between">
                <div>
                   <p class="text-slate-500 text-sm font-medium">ระดับชั้น ม.1</p>
                   <h1 id="m1Applicants" class="text-4xl font-bold text-slate-800 mt-1">0</h1>
                </div>
                 <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                   <i class="fa-solid fa-child text-xl"></i>
                </div>
            </div>
             <div class="glass-card rounded-2xl p-6 shadow-sm border-b-4 border-orange-500 flex items-center justify-between">
                <div>
                   <p class="text-slate-500 text-sm font-medium">ระดับชั้น ม.4</p>
                   <h1 id="m4Applicants" class="text-4xl font-bold text-slate-800 mt-1">0</h1>
                </div>
                 <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center text-orange-600">
                   <i class="fa-solid fa-user-graduate text-xl"></i>
                </div>
            </div>
        </div>

        <div class="glass-card rounded-2xl shadow-sm overflow-hidden">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center">
               <h3 class="font-bold text-lg text-slate-800 font-heading">รายชื่อผู้สมัครล่าสุด</h3>
               <button onclick="loadAllApplicants()" class="text-emerald-600 hover:text-emerald-800 text-sm font-medium">
                 <i class="fa-solid fa-rotate mr-1"></i> รีเฟรชข้อมูล
               </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-50 text-slate-600 text-sm uppercase tracking-wider border-b border-slate-200">
                            <th class="p-4 font-semibold">เลขบัตรฯ</th>
                            <th class="p-4 font-semibold">ชื่อ-สกุล</th>
                            <th class="p-4 font-semibold">ระดับชั้น</th>
                            <th class="p-4 font-semibold">โครงการ</th>
                            <th class="p-4 font-semibold text-right">จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="applicantsTableBody" class="divide-y divide-slate-100">
                        <tr><td colspan="5" class="p-8 text-center text-slate-400">กำลังโหลดข้อมูล...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="adminDetailView" class="view">
        <div class="max-w-4xl mx-auto">
           <button onclick="backToDashboard()" class="mb-4 text-slate-500 hover:text-emerald-600 font-medium">
             <i class="fa-solid fa-arrow-left mr-1"></i> กลับหน้าแดชบอร์ด
           </button>
           
           <div class="glass-card rounded-2xl shadow-lg p-8">
              <div class="border-b border-slate-200 pb-4 mb-6 flex justify-between items-start">
                 <div>
                    <h2 class="text-2xl font-bold text-slate-800 font-heading">รายละเอียดผู้สมัคร</h2>
                    <p class="text-sm text-slate-500 mt-1">ตรวจสอบและอัปเดตสถานะ</p>
                 </div>
                 <div class="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full text-sm font-medium" id="statusBadgeDisplay">
                    สถานะ: รอตรวจสอบ
                 </div>
              </div>
              
              <div id="applicantDetailContent" class="space-y-4 text-slate-700">
                 </div>
              
              <div class="mt-8 pt-6 border-t border-slate-100 bg-slate-50 -mx-8 -mb-8 p-8 rounded-b-2xl">
                 <div class="flex flex-col md:flex-row items-center gap-4 justify-end">
                    <label class="font-medium text-slate-700">อัปเดตสถานะ:</label>
                    <select id="editStatus" class="input-modern md:w-64 bg-white">
                        <option value="สมัครแล้ว">สมัครแล้ว</option>
                        <option value="เอกสารครบถ้วน">เอกสารครบถ้วน</option>
                        <option value="รอการแก้ไข">รอการแก้ไข</option>
                        <option value="ผ่านการคัดเลือก">ผ่านการคัดเลือก</option>
                    </select>
                    <button onclick="saveStatus()" class="btn-gradient py-2 px-6 shadow-none">
                       บันทึกสถานะ
                    </button>
                 </div>
              </div>
           </div>
        </div>
    </div>

  </main>

  <div id="toast" class="fixed bottom-5 right-5 bg-slate-800 text-white px-6 py-4 rounded-xl shadow-2xl transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-3">
     <i class="fa-solid fa-circle-info text-emerald-400"></i>
     <span id="toastMsg">Notification Message</span>
  </div>

  <script>
    // ==========================================
    // ⚠️⚠️ CONFIGURATION ⚠️⚠️
    // ใส่ URL ของ Web App ที่ได้จากการ Deploy ที่นี่
    // ==========================================
    const SCRIPT_URL = 'YOUR_WEB_APP_URL_HERE'; 

    let currentUser = null;
    let currentIdCard = null;
    let allApplicants = [];
    let currentApplicant = null;

    // --- Navigation Functions ---
    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => {
          v.classList.remove('active');
          v.style.display = 'none'; // Ensure explicit hide
        });
        
        const target = document.getElementById(viewId);
        target.style.display = 'block';
        // Allow DOM reflow for transition
        setTimeout(() => target.classList.add('active'), 10);
        window.scrollTo(0, 0);
    }

    function showToast(msg, type = 'info') {
        const t = document.getElementById('toast');
        const msgSpan = document.getElementById('toastMsg');
        msgSpan.innerText = msg;
        
        // Simple color switch based on type could be added here
        
        t.classList.remove('translate-y-20', 'opacity-0');
        setTimeout(() => {
           t.classList.add('translate-y-20', 'opacity-0');
        }, 3000);
    }

    function logout() {
        currentUser = null;
        currentIdCard = null;
        document.getElementById('applicationForm').reset();
        showView('studentLoginView');
    }

    // --- Student Login ---
    document.getElementById('studentLoginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const idCard = document.getElementById('studentIdCard').value;
        if(idCard.length !== 13) { showToast('กรุณากรอกเลข 13 หลัก'); return; }
        
        currentIdCard = idCard;
        currentUser = 'student';
        document.getElementById('idCard').value = idCard;
        showView('applicationFormView');
        showToast('เข้าสู่ระบบสำเร็จ');
    });

    // --- Other Docs Checkbox ---
    document.getElementById('otherDocCheck').addEventListener('change', function(e) {
        const container = document.getElementById('otherDocContainer');
        if(e.target.checked) {
           container.classList.remove('hidden');
        } else {
           container.classList.add('hidden');
        }
    });

    // --- Submit Application ---
    document.getElementById('applicationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<div class="loader"></div> กำลังบันทึก...';
        btn.disabled = true;
        btn.classList.add('opacity-75', 'cursor-not-allowed');

        // Collect Data
        const formData = {
            action: 'submit',
            idCard: document.getElementById('idCard').value,
            prefix: document.getElementById('prefix').value,
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            firstNameEn: document.getElementById('firstNameEn').value,
            lastNameEn: document.getElementById('lastNameEn').value,
            birthDate: document.getElementById('birthDate').value,
            birthHospital: document.getElementById('birthHospital').value,
            bloodType: document.getElementById('bloodType').value,
            nationality: document.getElementById('nationality').value,
            ethnicity: document.getElementById('ethnicity').value,
            religion: document.getElementById('religion').value,
            serviceArea: document.querySelector('input[name="serviceArea"]:checked')?.value || '',
            subdistrict: document.getElementById('subdistrict').value,
            district: document.getElementById('district').value,
            province: document.getElementById('province').value,
            previousSchool: document.getElementById('previousSchool').value,
            gradeLevel: document.getElementById('gradeLevel').value,
            gpa: document.getElementById('gpa').value,
            program: document.querySelector('input[name="program"]:checked')?.value || '',
            documents: Array.from(document.querySelectorAll('input[name="documents"]:checked')).map(c=>c.value).join(', '),
            otherDocument: document.getElementById('otherDocument').value
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(formData)
        })
        .then(res => res.json())
        .then(data => {
            if(data.success) {
                showToast('บันทึกข้อมูลสำเร็จ!');
                setTimeout(() => logout(), 1500);
            } else {
                showToast('เกิดข้อผิดพลาด: ' + data.error);
            }
        })
        .catch(err => {
            console.error(err);
            showToast('ไม่สามารถเชื่อมต่อระบบได้');
        })
        .finally(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
            btn.classList.remove('opacity-75', 'cursor-not-allowed');
        });
    });

    // --- Admin System ---
    document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const u = document.getElementById('adminUsername').value;
        const p = document.getElementById('adminPassword').value;
        
        if(u === 'admin' && p === '1234') { 
            currentUser = 'admin';
            showView('adminDashboardView');
            loadAllApplicants();
        } else {
            showToast('รหัสผ่านไม่ถูกต้อง');
        }
    });

    function loadAllApplicants() {
        const tbody = document.getElementById('applicantsTableBody');
        tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-slate-400"><div class="loader border-slate-300 border-t-emerald-500 inline-block mr-2"></div> กำลังโหลดข้อมูล...</td></tr>';
        
        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'getAll' })
        })
        .then(res => res.json())
        .then(result => {
            if(result.success) {
                allApplicants = result.data;
                renderDashboard();
            }
        });
    }

    function renderDashboard() {
        // Stats
        document.getElementById('totalApplicants').innerText = allApplicants.length;
        document.getElementById('m1Applicants').innerText = allApplicants.filter(a => a.gradeLevel === 'ม.1').length;
        document.getElementById('m4Applicants').innerText = allApplicants.filter(a => a.gradeLevel === 'ม.4').length;

        // Table
        const tbody = document.getElementById('applicantsTableBody');
        if(allApplicants.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-slate-400">ยังไม่มีข้อมูลผู้สมัคร</td></tr>';
            return;
        }
        
        let html = '';
        allApplicants.forEach((app) => {
            html += `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="p-4 text-slate-700 font-medium border-b border-slate-100">${app.idCard}</td>
                    <td class="p-4 text-slate-600 border-b border-slate-100">${app.prefix}${app.firstName} ${app.lastName}</td>
                    <td class="p-4 border-b border-slate-100">
                        <span class="px-2 py-1 rounded text-xs font-semibold bg-purple-100 text-purple-700">${app.gradeLevel}</span>
                    </td>
                    <td class="p-4 text-slate-600 border-b border-slate-100">${app.program}</td>
                    <td class="p-4 border-b border-slate-100 text-right">
                        <button class="text-emerald-600 hover:text-emerald-800 bg-emerald-50 hover:bg-emerald-100 px-3 py-1 rounded-lg text-sm transition-colors" onclick="viewDetail('${app.idCard}')">
                           <i class="fa-solid fa-eye"></i> ดู
                        </button>
                    </td>
                </tr>
            `;
        });
        tbody.innerHTML = html;
    }

    function viewDetail(id) {
        currentApplicant = allApplicants.find(a => a.idCard === id);
        if(!currentApplicant) return;
        
        // Update Status Badge
        const badge = document.getElementById('statusBadgeDisplay');
        badge.innerText = `สถานะ: ${currentApplicant.status || 'สมัครแล้ว'}`;

        const content = document.getElementById('applicantDetailContent');
        content.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
               <div class="p-4 bg-slate-50 rounded-xl">
                  <p class="text-xs text-slate-400 uppercase font-bold mb-1">ข้อมูลส่วนตัว</p>
                  <p class="font-medium text-lg text-slate-800">${currentApplicant.prefix}${currentApplicant.firstName} ${currentApplicant.lastName}</p>
                  <p class="text-slate-500">เลขบัตร: ${currentApplicant.idCard}</p>
               </div>
               <div class="p-4 bg-slate-50 rounded-xl">
                  <p class="text-xs text-slate-400 uppercase font-bold mb-1">การศึกษาเดิม</p>
                  <p class="font-medium text-slate-800">${currentApplicant.previousSchool}</p>
                  <p class="text-slate-500">GPA: <span class="text-emerald-600 font-bold">${currentApplicant.gpa}</span></p>
               </div>
               <div class="p-4 bg-slate-50 rounded-xl">
                  <p class="text-xs text-slate-400 uppercase font-bold mb-1">การสมัคร</p>
                  <p>ระดับชั้น: <span class="font-semibold text-slate-800">${currentApplicant.gradeLevel}</span></p>
                  <p>แผนการเรียน: <span class="font-semibold text-slate-800">${currentApplicant.program}</span></p>
               </div>
               <div class="p-4 bg-slate-50 rounded-xl">
                  <p class="text-xs text-slate-400 uppercase font-bold mb-1">เอกสารแนบ</p>
                  <p class="text-slate-600">${currentApplicant.documents}</p>
                  ${currentApplicant.otherDocument ? `<p class="text-sm text-slate-500 mt-1">เพิ่มเติม: ${currentApplicant.otherDocument}</p>` : ''}
               </div>
            </div>
            
            <div class="mt-4 p-4 border border-slate-100 rounded-xl">
               <p class="text-xs text-slate-400 uppercase font-bold mb-1">ที่อยู่</p>
               <p class="text-slate-600">
                 ต.${currentApplicant.subdistrict} อ.${currentApplicant.district} จ.${currentApplicant.province}
                 (${currentApplicant.serviceArea})
               </p>
            </div>
        `;
        
        document.getElementById('editStatus').value = currentApplicant.status || 'สมัครแล้ว';
        showView('adminDetailView');
    }

    function backToDashboard() {
        showView('adminDashboardView');
    }

    function saveStatus() {
        if(!currentApplicant) return;
        const newStatus = document.getElementById('editStatus').value;
        const btn = event.target; // Capture button to animate if needed
        const originalText = btn.innerText;
        btn.innerText = 'กำลังบันทึก...';
        
        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({
                action: 'update',
                idCard: currentApplicant.idCard,
                status: newStatus
            })
        })
        .then(res => res.json())
        .then(data => {
            if(data.success) {
                showToast('อัปเดตสถานะเรียบร้อย');
                currentApplicant.status = newStatus;
                
                // Update badge immediately
                document.getElementById('statusBadgeDisplay').innerText = `สถานะ: ${newStatus}`;
                loadAllApplicants(); // Refresh background data
            }
        })
        .finally(() => {
           btn.innerText = originalText;
        });
    }
  </script>
</body>
</html>
