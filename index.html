<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Upload Excel)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; }
    .hidden { display: none !important; }
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
    .input-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #1e3a8a; }
    .input-group input, .input-group select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; }
    .section-head { background: #e0f2fe; padding: 10px; font-weight: bold; color: #0c4a6e; border-left: 4px solid #0284c7; margin-top: 20px; margin-bottom: 10px; }
    /* ‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô */
    .tab-btn { padding: 12px 24px; cursor: pointer; border-bottom: 3px solid transparent; font-weight: bold; color: #64748b; }
    .tab-btn.active { border-bottom-color: #1e3a8a; color: #1e3a8a; background: #f1f5f9; border-radius: 8px 8px 0 0; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <div id="loginSection" class="min-h-screen flex flex-col md:flex-row">
    <div class="md:w-1/2 bg-blue-900 flex flex-col justify-center items-center text-white p-10 relative">
      <h1 class="text-4xl font-bold mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
      <h2 class="text-2xl opacity-90">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</h2>
      <div class="mt-8 text-center text-blue-200"><p>‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p></div>
      <button onclick="toggleAdminLogin()" class="absolute bottom-4 left-4 text-blue-400 text-xs hover:text-white">Admin Login</button>
    </div>
    <div class="md:w-1/2 bg-white flex flex-col justify-center items-center p-8">
      <div class="w-full max-w-md">
        <div id="studentLoginBox">
          <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</h3>
          <form onsubmit="handleLogin(event, 'student')" class="space-y-4">
            <input type="text" id="loginIdCard" maxlength="13" required class="w-full p-4 border rounded-lg text-xl text-center tracking-widest bg-gray-50 focus:bg-white transition" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å">
            <button type="submit" id="btnLoginStudent" class="w-full bg-blue-900 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-800 shadow-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          </form>
        </div>
        <div id="adminLoginBox" class="hidden">
          <h3 class="text-2xl font-bold text-red-800 mb-6 text-center">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
          <form onsubmit="handleLogin(event, 'admin')" class="space-y-4">
            <input type="password" id="adminPass" required class="w-full p-3 border rounded" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô">
            <button type="submit" id="btnLoginAdmin" class="w-full bg-red-800 text-white py-3 rounded-lg font-bold hover:bg-red-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            <button type="button" onclick="toggleAdminLogin()" class="w-full text-gray-500 mt-2 text-sm text-center underline">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="adminSection" class="hidden min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden min-h-[80vh]">
      <div class="bg-gray-800 text-white p-5 flex justify-between items-center shadow-md">
        <h2 class="text-2xl font-bold flex items-center gap-2"><span class="text-2xl">‚öôÔ∏è</span> ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h2>
        <button onclick="location.reload()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-sm font-bold transition">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>

      <div class="flex border-b bg-gray-50">
        <div onclick="switchTab('applicants')" id="tab-applicants" class="tab-btn active">üìÑ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (PDF)</div>
        <div onclick="switchTab('import')" id="tab-import" class="tab-btn">üì• ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (Excel)</div>
      </div>

      <div id="view-applicants" class="p-6">
        <div class="flex justify-between items-center mb-4">
           <h3 class="font-bold text-lg text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤</h3>
           <span class="text-sm text-gray-500">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
        </div>
        <div class="overflow-x-auto border rounded-lg shadow-sm">
          <table class="w-full text-left border-collapse">
            <thead class="bg-blue-50 text-blue-900 uppercase text-sm">
              <tr><th class="p-3 border-b">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th><th class="p-3 border-b">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£</th><th class="p-3 border-b">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th class="p-3 border-b text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
            </thead>
            <tbody id="adminTableBody" class="bg-white"></tbody>
          </table>
        </div>
      </div>

      <div id="view-import" class="p-6 hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          
          <div>
            <div class="bg-green-50 p-4 rounded-lg border border-green-200 mb-6">
              <h3 class="font-bold text-green-900 mb-2 text-lg">üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ü‡∏•‡πå Excel</h3>
              <ul class="list-disc pl-5 text-sm text-green-800 space-y-2">
                <li>‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå <b>.xlsx</b> ‡∏´‡∏£‡∏∑‡∏≠ <b>.xls</b></li>
                <li><b>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A (‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å):</b> ‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (13 ‡∏´‡∏•‡∏±‡∏Å)</li>
                <li><b>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå B (‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏á):</b> ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</li>
                <li>‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å</li>
              </ul>
            </div>
            
            <label class="block font-bold mb-2 text-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:</label>
            <div class="flex items-center justify-center w-full">
                <label for="excelFile" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                        </svg>
                        <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span> ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á</p>
                        <p class="text-xs text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö .XLSX, .XLS</p>
                    </div>
                    <input id="excelFile" type="file" class="hidden" accept=".xlsx, .xls" onchange="handleFileUpload(event)" />
                </label>
            </div>
            <div id="fileNameDisplay" class="mt-2 text-center text-blue-600 font-bold hidden"></div>
            
            <button onclick="clearImport()" class="mt-4 w-full bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
          </div>

          <div class="flex flex-col h-full">
            <div class="flex justify-between items-center mb-2">
              <h3 class="font-bold text-gray-700">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
              <span id="previewCount" class="text-sm bg-gray-200 px-2 py-1 rounded">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>
            
            <div class="flex-grow border rounded-lg overflow-y-auto bg-gray-50 h-64 lg:h-auto relative">
              <table class="w-full text-sm">
                <thead class="bg-gray-200 sticky top-0">
                  <tr><th class="p-2 w-1/3">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ (Column A)</th><th class="p-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• (Column B)</th></tr>
                </thead>
                <tbody id="previewTableBody">
                  <tr><td colspan="2" class="p-10 text-center text-gray-400 italic">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢</td></tr>
                </tbody>
              </table>
            </div>

            <button id="btnConfirmImport" onclick="confirmImport()" class="mt-4 w-full bg-green-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-green-700 shadow-lg opacity-50 cursor-not-allowed" disabled>
              ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>
            <p class="text-xs text-red-500 mt-2 text-center">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏µ‡πâ</p>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div id="formSection" class="hidden p-4 md:p-8 max-w-5xl mx-auto">
     <div class="bg-white p-10 text-center rounded shadow">
       <h2 class="text-2xl font-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
       <p class="text-gray-500">(‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö)</p>
       <button onclick="location.reload()" class="mt-4 text-blue-500 underline">Reload</button>
     </div>
  </div>

  <script>
    // üî¥üî¥üî¥ URL Script ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ Backend) üî¥üî¥üî¥
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxtWZwXSFcbdrrPZSLrs4kmEDYB4fqx3MxUs0Wo40lgkAyIi_6C-j0AJ3YZgWOBJ16AHw/exec'; 

    let tempImportData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß

    function toggleAdminLogin() {
      document.getElementById('studentLoginBox').classList.toggle('hidden');
      document.getElementById('adminLoginBox').classList.toggle('hidden');
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('view-applicants').classList.add('hidden');
      document.getElementById('view-import').classList.add('hidden');
      document.getElementById('tab-' + tabName).classList.add('active');
      document.getElementById('view-' + tabName).classList.remove('hidden');
    }

    // üü¢ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel (‡πÉ‡∏´‡∏°‡πà)
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
      const nameDisp = document.getElementById('fileNameDisplay');
      nameDisp.innerText = "‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: " + file.name;
      nameDisp.classList.remove('hidden');

      const reader = new FileReader();
      
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        
        // ‡∏≠‡πà‡∏≤‡∏ô Sheet ‡πÅ‡∏£‡∏Å
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        
        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON (Array of Arrays) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢
        // header: 1 ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÉ‡∏´‡πâ return ‡πÄ‡∏õ‡πá‡∏ô [[A1, B1], [A2, B2], ...]
        const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
        
        processExcelData(jsonData);
      };
      
      reader.readAsArrayBuffer(file);
    }

    function processExcelData(rows) {
      tempImportData = [];
      
      // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏µ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß
      rows.forEach((row, index) => {
        if (row.length === 0) return; // ‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß‡∏ß‡πà‡∏≤‡∏á

        // ‡∏™‡∏°‡∏°‡∏ï‡∏¥ Column 0 = ID, Column 1 = Name
        let id = row[0] ? String(row[0]).trim() : '';
        let name = row[1] ? String(row[1]).trim() : '';

        // ‡∏Å‡∏£‡∏≠‡∏á: ID ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏ß‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏´‡∏•‡∏±‡∏Å)
        if (id && id.length >= 5 && !isNaN(id.replace(/-/g, ''))) {
           tempImportData.push({ id: id, name: name });
        }
      });

      renderPreviewTable();
    }

    function renderPreviewTable() {
      const tbody = document.getElementById('previewTableBody');
      const countLabel = document.getElementById('previewCount');
      const btnSave = document.getElementById('btnConfirmImport');

      countLabel.innerText = tempImportData.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
      tbody.innerHTML = '';

      if (tempImportData.length === 0) {
         tbody.innerHTML = '<tr><td colspan="2" class="p-4 text-center text-red-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</td></tr>';
         btnSave.disabled = true;
         btnSave.classList.add('opacity-50', 'cursor-not-allowed');
      } else {
         // ‡πÇ‡∏ä‡∏ß‡πå‡πÅ‡∏Ñ‡πà 100 ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏û‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å
         const displayLimit = tempImportData.slice(0, 100); 
         displayLimit.forEach(item => {
            tbody.innerHTML += `<tr class="border-b bg-white"><td class="p-2 font-mono text-blue-800">${item.id}</td><td class="p-2">${item.name}</td></tr>`;
         });
         
         if (tempImportData.length > 100) {
             tbody.innerHTML += `<tr><td colspan="2" class="p-2 text-center text-gray-500">... ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${tempImportData.length - 100} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ...</td></tr>`;
         }

         btnSave.disabled = false;
         btnSave.classList.remove('opacity-50', 'cursor-not-allowed');
      }
    }

    function clearImport() {
      document.getElementById('excelFile').value = '';
      document.getElementById('fileNameDisplay').classList.add('hidden');
      document.getElementById('previewTableBody').innerHTML = '<tr><td colspan="2" class="p-10 text-center text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢</td></tr>';
      document.getElementById('previewCount').innerText = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
      document.getElementById('btnConfirmImport').disabled = true;
      document.getElementById('btnConfirmImport').classList.add('opacity-50');
      tempImportData = [];
    }

    function confirmImport() {
      if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${tempImportData.length} ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠?\n(‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)`)) return;

      const btn = document.getElementById('btnConfirmImport');
      btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';
      btn.disabled = true;

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'updateWhitelist', listData: tempImportData })
      })
      .then(res => res.json())
      .then(json => {
         if(json.success) {
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ');
            clearImport();
         } else {
            alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + json.error);
         }
      })
      .catch(err => alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + err))
      .finally(() => {
         btn.innerText = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
      });
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô Login & Render (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ---
    function handleLogin(e, role) {
      e.preventDefault();
      let payload = { action: 'login' };
      let btn;

      if (role === 'student') {
        payload.idCard = document.getElementById('loginIdCard').value;
        if(!payload.idCard) { alert('‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£'); return; }
        btn = document.getElementById('btnLoginStudent');
      } else {
        payload.idCard = 'admin';
        payload.password = document.getElementById('adminPass').value;
        btn = document.getElementById('btnLoginAdmin');
      }
      
      btn.innerText = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...'; btn.disabled = true;

      fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
      .then(res => res.json())
      .then(json => {
        if (json.error) {
           alert('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ' + json.error);
        } else {
           document.getElementById('loginSection').classList.add('hidden');
           if (json.role === 'admin') {
              document.getElementById('adminSection').classList.remove('hidden');
              renderApplicants(json.data);
           } else {
              document.getElementById('formSection').classList.remove('hidden');
              // ... logic populate form ...
           }
        }
      })
      .finally(() => { btn.innerText = (role==='student'?'‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö':'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô'); btn.disabled = false; });
    }

    function renderApplicants(data) {
       const tbody = document.getElementById('adminTableBody');
       tbody.innerHTML = '';
       if(!data || data.length === 0) {
         tbody.innerHTML = '<tr><td colspan="4" class="p-4 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</td></tr>'; return;
       }
       data.forEach(r => {
         tbody.innerHTML += `
           <tr class="border-b hover:bg-gray-50">
             <td class="p-3 text-gray-600">${new Date(r.timestamp).toLocaleString('th-TH')}</td>
             <td class="p-3 font-mono font-bold">${r.idCard}</td>
             <td class="p-3">${r.name}</td>
             <td class="p-3 text-center"><a href="${r.pdfUrl}" target="_blank" class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200">‡πÄ‡∏õ‡∏¥‡∏î PDF</a></td>
           </tr>
         `;
       });
    }

  </script>
</body>
</html>
